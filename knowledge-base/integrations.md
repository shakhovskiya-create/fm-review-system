# Схема интеграций EKF

> Источник: Confluence EW > ДИТ > Архитектура (Схема AS IS, Схема TO BE)

## Текущая архитектура (AS IS)

Интеграция **точка-точка** (без шины данных).

### Основные потоки данных

```
1С:ERP (производство)  ──ПТУ──►  1С:УТ (торговля)
                                    │
                              ┌─────┼─────┐
                              ▼     ▼     ▼
                           1С:БП  Сайт  EKF Market
                                  (API 2.0)
```

| Поток | Откуда | Куда | Что передаётся | Как |
|-------|--------|------|----------------|-----|
| Приход от производства | 1С:ERP (3 площадки) | 1С:УТ | ПТУ (товар) | HTTP/файлы |
| Внутренние цены | 1С:ERP | 1С:УТ | Внутренняя стоимость (SBS-130) | Специальный обмен |
| Продажи в бухгалтерию | 1С:УТ | 1С:БП | РТУ, платежи | HTTP/файлы |
| Заказы с сайта | Сайт / API 2.0 | 1С:УТ | Заказы покупателей | REST API |
| B2B-заказы | EKF Market | 1С:УТ | Заказы | REST API |
| Цены и остатки | 1С:УТ | Сайт / API 2.0 | Прайсы, складские остатки | REST API |
| Кадры | 1С:ЗУП | VK HR Tek (КЭДО) | Кадровые документы | - |
| Управленческий учёт | 1С:УТ + 1С:БП | 1С:УХ | Консолидация | - |
| BPM-процессы | 1С:УТ | ELMA | Согласование (возвраты, заказы) | API |
| Контроль качества | 1С:ERP | EproQc | Данные о качестве | - |

### EDI-интеграция
- EDI-заказы: внешние системы → 1С:УТ
- Ограничение: только полная отмена заказа (нет частичной)
- В нашей ФМ: EDI частичная отгрузка = приоритет 1 в Этапе 2

## Целевая архитектура (TO BE)

> Confluence: Схема TO BE v14

### Шина данных (Kafka)
Проект «Внедрение шины данных» (ID: 2294381) — переход от точка-точка к централизованной шине.

**Целевая схема:**
```
1С:УТ  ──►  Kafka  ──►  Go-сервисы  ──►  Фронтенд (React)
1С:ERP ──►  Kafka  ──►  IMS3
ELMA   ──►  Kafka  ──►  Уведомления
```

### Go-микросервисы
- Шаблоны Go-сервисов описаны в целевой архитектуре
- Текущие сервисы: 488+ записей изменений в «Описания работы сервисов» (v332)
- Основной стек: Go + React + Kafka

### Влияние на нашу ФМ
- Сейчас: интеграция 1С:УТ ↔ ELMA для согласования напрямую
- Будущее: может перейти на Kafka
- Резервный режим ELMA в ФМ: предусмотрен (автосогласование до 5 п.п.)

## Сервисы (из «Описания работы сервисов»)

Крупная страница (232K символов, v332) содержит реестр всех доработок и изменений во всех сервисах компании. 488+ записей.

**Ключевые для нашего проекта:**
- API продаж и заказов
- Интеграция с ELMA (согласование)
- Обмен с 1С:БП (бухгалтерские документы)
- Механизм уведомлений (для SLA и эскалации)
