#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö 22 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
"""

from docx import Document

def check_fix(doc, keywords, fix_id, fix_description):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º"""
    found = False
    found_para = None

    for i, para in enumerate(doc.paragraphs):
        text = para.text.lower()
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        if all(kw.lower() in text for kw in keywords):
            found = True
            found_para = i
            break

    status = "‚úÖ" if found else "‚ùå"
    print(f"{status} {fix_id}: {fix_description}")
    if found:
        print(f"    –ù–∞–π–¥–µ–Ω–æ –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ {found_para}")
        print(f"    –¢–µ–∫—Å—Ç: {doc.paragraphs[found_para].text[:100]}...")
    else:
        print(f"    ‚ùå –ù–ï –ù–ê–ô–î–ï–ù–û! –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {keywords}")

    return found

def main():
    print("=" * 70)
    print("–í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò 22 –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô")
    print("=" * 70)
    print()

    input_file = '/Users/antonsahovskii/Documents/claude-agents/fm-review-system/PROJECT_SHPMNT_PROFIT/FM_DOCUMENTS/FM-LS-PROFIT-v1.2.0.docx'

    print(f"üìñ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {input_file}")
    doc = Document(input_file)
    print(f"   –í—Å–µ–≥–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤: {len(doc.paragraphs)}")
    print()

    print("=" * 70)
    print("–ü–†–û–í–ï–†–ö–ê –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô (7)")
    print("=" * 70)
    print()

    critical_found = 0

    if check_fix(doc, ["race condition", "–∞—Ç–æ–º–∞—Ä–Ω", "–±–ª–æ–∫–∏—Ä"],
                 "CRIT-001", "–ó–∞—â–∏—Ç–∞ –æ—Ç race condition"):
        critical_found += 1

    print()
    if check_fix(doc, ["—É—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞", "–Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è", "–Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏"],
                 "CRIT-002", "–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏"):
        critical_found += 1

    print()
    if check_fix(doc, ["—á–µ—Ä–Ω–æ–≤–∏–∫", "–Ω–µ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç"],
                 "CRIT-003", "–§–∏–∫—Å–∞—Ü–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏"):
        critical_found += 1

    print()
    if check_fix(doc, ["–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ", "–¥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è", "15.005"],
                 "CRIT-004", "–ü—Ä–∞–≤–∏–ª–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è"):
        critical_found += 1

    print()
    if check_fix(doc, ["–ø–µ—Ä–µ—Å—á–µ—Ç —Å–∞–Ω–∫—Ü–∏–π", "—Ä–µ–≥–ª–∞–º–µ–Ω—Ç–Ω–æ–µ", "60 –¥–Ω–µ–π"],
                 "CRIT-005", "–†–µ–≥–ª–∞–º–µ–Ω—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ"):
        critical_found += 1

    print()
    if check_fix(doc, ["–∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω", "1 —Ä–∞–∑", "–∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é"],
                 "CRIT-006", "–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –õ–°"):
        critical_found += 1

    print()
    if check_fix(doc, ["—á–∞—Å—Ç–∏—á–Ω", "–Ω–∞–ª–∏—á–∏", "–≤ –¥–µ—Ñ–∏—Ü–∏—Ç–µ"],
                 "CRIT-007", "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏"):
        critical_found += 1

    print()
    print("=" * 70)
    print("–ü–†–û–í–ï–†–ö–ê –í–´–°–û–ö–û–ü–†–ò–û–†–ò–¢–ï–¢–ù–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô (9)")
    print("=" * 70)
    print()

    high_found = 0

    if check_fix(doc, ["–∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω", "–∏–∑–º–µ–Ω–µ–Ω–∏–∏", "–ª—é–±–æ–º"],
                 "HIGH-001", "–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –õ–°"):
        high_found += 1

    print()
    if check_fix(doc, ["–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç", "–ø–µ—Ä–µ—á–∏—Ç"],
                 "HIGH-002", "–ê—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞"):
        high_found += 1

    print()
    if check_fix(doc, ["push", "—É–≤–µ–¥–æ–º–ª–µ–Ω–∏", "—ç–∫—Å—Ç—Ä–µ–Ω–Ω"],
                 "HIGH-003", "Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"):
        high_found += 1

    print()
    if check_fix(doc, ["—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü", "3 –º–µ—Å—è—Ü–∞", "–∫–≤–∞—Ä—Ç–∞–ª"],
                 "HIGH-004", "–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è —Å–∞–Ω–∫—Ü–∏–π"):
        high_found += 1

    print()
    if check_fix(doc, ["—ç—Å–∫–∞–ª–∞—Ü", "80 –¥–Ω–µ–π"],
                 "HIGH-005", "–≠—Å–∫–∞–ª–∞—Ü–∏—è –ù–ü–°–°"):
        high_found += 1

    print()
    if check_fix(doc, ["—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞", "—Å–≤—è–∑–∞–Ω–Ω", "—Ä—Ç—É"],
                 "HIGH-006", "–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞"):
        high_found += 1

    print()
    if check_fix(doc, ["–æ—Ç–º–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ", "–º—É–ª—å—Ç–∏"],
                 "HIGH-007", "–ú—É–ª—å—Ç–∏-–ë–Æ –∑–∞–∫–∞–∑"):
        high_found += 1

    print()
    if check_fix(doc, ["–¥–≤–æ–π–Ω–æ–π –ª–∏–º–∏—Ç", "–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç", "5"],
                 "HIGH-008", "–õ–∏–º–∏—Ç –ø–æ –∫–ª–∏–µ–Ω—Ç—É"):
        high_found += 1

    print()
    if check_fix(doc, ["—Ç–∏–ø—ã —Ä–µ–∑–µ—Ä–≤–æ–≤", "–ª–æ–≥–∏—á–µ—Å–∫–∏–π", "—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π"],
                 "HIGH-009", "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–æ–≤"):
        high_found += 1

    print()
    print("=" * 70)
    print("–ü–†–û–í–ï–†–ö–ê –°–†–ï–î–ù–ï–ü–†–ò–û–†–ò–¢–ï–¢–ù–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô (4)")
    print("=" * 70)
    print()

    medium_found = 0

    if check_fix(doc, ["—Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏", "–∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω"],
                 "MED-001", "–ê–≤—Ç–æ—Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏"):
        medium_found += 1

    print()
    if check_fix(doc, ["—Å—Ç–æ—Ä–Ω–∏—Ä–æ–≤–∞–Ω–Ω", "–∏—Å–∫–ª—é—á–∞—é—Ç—Å—è"],
                 "MED-003", "–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–æ—Ä–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –†–¢–£"):
        medium_found += 1

    print()
    if check_fix(doc, ["–ø–æ—Ä–æ–≥ —É–±—ã—Ç–∫–∞", "-0.1%"],
                 "MED-004", "–ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —É–±—ã—Ç–∫–∞"):
        medium_found += 1

    print()
    if check_fix(doc, ["–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω", "–Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π"],
                 "MED-005", "–†–¢–£ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è"):
        medium_found += 1

    print()
    print("=" * 70)
    print("–ü–†–û–í–ï–†–ö–ê –ù–ò–ó–ö–û–ü–†–ò–û–†–ò–¢–ï–¢–ù–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô (2)")
    print("=" * 70)
    print()

    low_found = 0

    if check_fix(doc, ["–≥—Ä–∞–Ω–∏—Ü—ã", "—à–∫–∞–ª", "94.99"],
                 "LOW-001", "–£—Ç–æ—á–Ω–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü KPI"):
        low_found += 1

    print()
    if check_fix(doc, ["–∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω", "–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è"],
                 "LOW-002", "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FAQ"):
        low_found += 1

    print()
    print("=" * 70)
    print("–ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò")
    print("=" * 70)
    print()

    total_found = critical_found + high_found + medium_found + low_found
    total_expected = 22

    print(f"‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (CRIT):  {critical_found}/7")
    print(f"‚úÖ –í—ã—Å–æ–∫–∏–µ (HIGH):       {high_found}/9")
    print(f"‚úÖ –°—Ä–µ–¥–Ω–∏–µ (MED):        {medium_found}/4")
    print(f"‚úÖ –ù–∏–∑–∫–∏–µ (LOW):         {low_found}/2")
    print()
    print(f"üìä –ò–¢–û–ì–û: {total_found}/{total_expected} –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞–π–¥–µ–Ω–æ")
    print(f"   –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {total_found/total_expected*100:.1f}%")

    if total_found == total_expected:
        print("\nüéâ –í–°–ï 22 –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –£–°–ü–ï–®–ù–û –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–´!")
    else:
        print(f"\n‚ö†Ô∏è  –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç {total_expected - total_found} –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π")

    print("=" * 70)

if __name__ == "__main__":
    main()
