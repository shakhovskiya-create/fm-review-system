---
description: Confluence как единственный источник ФМ - чтение, запись, верификация
globs: ["scripts/**", "projects/**", "agents/AGENT_7*"]
alwaysApply: false
---

# Confluence - Единственный источник ФМ

## Принцип
Confluence = единственный источник правды. Все читают ФМ оттуда, все правки вносятся туда.
Word/DOCX - ЗАПРЕЩЕНЫ как источник актуальной ФМ.

## API
- URL: https://confluence.ekf.su
- Endpoint: /rest/api/content/{PAGE_ID}
- Auth: Bearer token (PAT)
- Формат: XHTML storage

## При обновлении ФМ - ТРИ обязательных места на странице

1. **Мета-блок** (строка вверху) - обновить версию X.Y.Z + дату ДД.ММ.ГГГГ
2. **Мета-таблица** (Версия/Дата/Статус/Автор) - обновить версию + дату
3. **Таблица "История версий"** - ДОБАВИТЬ строку в конец (не удаляя старые!)
   - Автор: ВСЕГДА "Шаховский А.С."
   - Описание: бизнес-язык, БЕЗ кодов (CRIT-001), БЕЗ технического жаргона

## Версионирование
X.Y.Z: X - мажорная (новый процесс), Y - минорная (новые разделы), Z - патч (исправления)

## Верификация после КАЖДОГО PUT (обязательно!)
1. GET страницы из Confluence
2. Проверить ОТСУТСТВИЕ старых значений в XHTML
3. Проверить НАЛИЧИЕ новых значений
4. Проверить version.number инкрементирован
5. Все строки истории на месте, даты/авторы не изменились
НЕ отмечать "Готово" без реальной проверки!

## Таблица "История версий" - НЕПРИКОСНОВЕННА
- История ДОПОЛНЯЕТСЯ, НЕ РЕДАКТИРУЕТСЯ
- Запрещено менять ранее зафиксированные номера, даты, авторов
- НЕ использовать глобальные regex по версиям (затронет историю!)
- Заменять ТОЛЬКО в конкретных местах (мета-блок, мета-таблица)

## Перед правками - ПЛАН
1. Показать список изменений (Где → Было → Станет)
2. Получить подтверждение пользователя
3. Только после подтверждения - PUT
4. Верифицировать GET-ом
5. Создать CHANGES.md файл

## XHTML форматирование
- Новые строки/ячейки = КОПИРОВАТЬ style из соседних
- Заголовки таблиц: rgb(255,250,230), НИКОГДА rgb(59,115,175)
- Глоссарий: НЕ использовать <strong> в ячейках термина
