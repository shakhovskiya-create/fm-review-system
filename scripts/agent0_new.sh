#!/bin/bash

# AGENT_0 CREATOR — Интерактивный лаунчер
# Запуск: ./agent0_new.sh

set -e

YELLOW='\033[1;33m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
NC='\033[0m'

echo ""
echo -e "${YELLOW}═══════════════════════════════════════════════════════════${NC}"
echo -e "${YELLOW}  AGENT_0: CREATOR — Создание новой ФМ${NC}"
echo -e "${YELLOW}═══════════════════════════════════════════════════════════${NC}"
echo ""

# ШАГ 1: Проблема
PROBLEM=$(gum choose --header "? Какую проблему решаем?" \
    "1. Потери денег (скидки, недостачи, манипуляции)" \
    "2. Нет контроля процесса (делают как хотят)" \
    "3. Процесс тормозит (долго, много согласований) ⭐" \
    "4. Нет данных для решений (не видим картину)" \
    "5. Другое")

[[ "$PROBLEM" == "5. Другое" ]] && PROBLEM=$(gum input --placeholder "Опишите проблему...")
echo -e "${GREEN}✓${NC} Проблема: ${PROBLEM}"

# ШАГ 2: Стоимость
COST=$(gum choose --header "? Сколько это стоит бизнесу?" \
    "1. До 100К ₽/мес" \
    "2. 100К-500К ₽/мес ⭐" \
    "3. 500К-1М ₽/мес" \
    "4. Больше 1М ₽/мес" \
    "5. Не в деньгах — в часах/рисках")

[[ "$COST" == "5. Не в деньгах — в часах/рисках" ]] && COST=$(gum input --placeholder "Опишите...")
echo -e "${GREEN}✓${NC} Стоимость: ${COST}"

# ШАГ 3: Почему не работает
REASON=$(gum choose --header "? Почему сейчас не получается контролировать?" \
    "1. Процесса нет вообще" \
    "2. Процесс есть, но обходят ⭐" \
    "3. Процесс есть, но тормозит работу" \
    "4. Процесс есть, но нет данных/отчётов" \
    "5. Другое")

[[ "$REASON" == "5. Другое" ]] && REASON=$(gum input --placeholder "Опишите причину...")
echo -e "${GREEN}✓${NC} Причина: ${REASON}"

# ШАГ 4: Метрика
METRIC=$(gum choose --header "? Как поймём что проблема решена?" \
    "1. Уменьшатся потери на X%" \
    "2. Ускорится процесс на X минут/часов ⭐" \
    "3. Появится контроль/отчётность" \
    "4. Пока не знаю — нужна помощь" \
    "5. Другое")

[[ "$METRIC" == "5. Другое" ]] && METRIC=$(gum input --placeholder "Опишите метрику...")
echo -e "${GREEN}✓${NC} Метрика: ${METRIC}"

# ШАГ 5: Участники
ACTOR=$(gum choose --header "? Кто ключевой участник процесса?" \
    "1. Менеджер по продажам ⭐" \
    "2. Кладовщик/логист" \
    "3. Бухгалтер/финансист" \
    "4. Руководитель подразделения" \
    "5. Другое")

[[ "$ACTOR" == "5. Другое" ]] && ACTOR=$(gum input --placeholder "Укажите роль...")
echo -e "${GREEN}✓${NC} Участник: ${ACTOR}"

# ШАГ 6: Конфликт интересов
CONFLICT=$(gum choose --header "? Кто заинтересован обойти систему?" \
    "1. Менеджеры (ради плана) ⭐" \
    "2. Руководители (ради скорости)" \
    "3. Склад (ради упрощения)" \
    "4. Никто — все за контроль" \
    "5. Другое")

[[ "$CONFLICT" == "5. Другое" ]] && CONFLICT=$(gum input --placeholder "Опишите конфликт...")
echo -e "${GREEN}✓${NC} Конфликт: ${CONFLICT}"

# ШАГ 7: Конфигурация
CONFIG=$(gum choose --header "? Какая конфигурация 1С?" \
    "1. 1С:ERP" \
    "2. 1С:УТ (Управление торговлей) ⭐" \
    "3. 1С:КА (Комплексная автоматизация)" \
    "4. 1С:УХ + УТ" \
    "5. Самописная/другая")

[[ "$CONFIG" == "5. Самописная/другая" ]] && CONFIG=$(gum input --placeholder "Укажите конфигурацию...")
echo -e "${GREEN}✓${NC} Конфигурация: ${CONFIG}"

# ШАГ 8: Красные линии
REDLINE=$(gum choose --header "? Что точно НЕЛЬЗЯ замедлять?" \
    "1. Создание заказов" \
    "2. Отгрузку товара ⭐" \
    "3. Согласование цен/скидок" \
    "4. Ничего нельзя замедлять" \
    "5. Другое")

[[ "$REDLINE" == "5. Другое" ]] && REDLINE=$(gum input --placeholder "Укажите...")
echo -e "${GREEN}✓${NC} Красная линия: ${REDLINE}"

# ШАГ 9: Приоритет
PRIORITY=$(gum choose --header "? Что в приоритете?" \
    "1. Скорость — не тормозить операции" \
    "2. Баланс скорости и контроля ⭐" \
    "3. Контроль — максимальная защита" \
    "4. Простота — минимум обучения")

echo -e "${GREEN}✓${NC} Приоритет: ${PRIORITY}"

# ШАГ 10: Компромисс
DELAY=$(gum choose --header "? Допустимое замедление ради контроля?" \
    "1. 0 минут — контроль не должен тормозить" \
    "2. До 5 минут на сделку ⭐" \
    "3. До 30 минут на сделку" \
    "4. До 4 часов (асинхронное согласование)" \
    "5. Сколько нужно — контроль важнее")

echo -e "${GREEN}✓${NC} Допустимая задержка: ${DELAY}"

# Сохраняем контекст
CONTEXT="КОНТЕКСТ ИНТЕРВЬЮ (AGENT_0 CREATOR):
- Проблема: ${PROBLEM}
- Стоимость: ${COST}
- Причина: ${REASON}
- Метрика успеха: ${METRIC}
- Ключевой участник: ${ACTOR}
- Конфликт интересов: ${CONFLICT}
- Конфигурация 1С: ${CONFIG}
- Красная линия: ${REDLINE}
- Приоритет: ${PRIORITY}
- Допустимая задержка: ${DELAY}"

CONTEXT_FILE="/Users/antonsahovskii/Documents/claude-agents/fm-review-system/.interview_context.txt"
echo "$CONTEXT" > "$CONTEXT_FILE"

echo ""
echo -e "${YELLOW}═══════════════════════════════════════════════════════════${NC}"
echo -e "${GREEN}✅ Интервью завершено!${NC}"
echo -e "${YELLOW}═══════════════════════════════════════════════════════════${NC}"
echo ""
echo "Теперь в Claude Code напиши:"
echo -e "${CYAN}  /new${NC} или ${CYAN}/structure${NC}"
