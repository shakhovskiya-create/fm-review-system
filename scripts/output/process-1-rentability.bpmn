<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="18.10.1" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.8.0">
  <bpmn:collaboration id="Collaboration_1">
    <bpmn:participant id="Participant_Pool" name="Контроль рентабельности" processRef="Process_Rentability" />
  </bpmn:collaboration>
  <bpmn:process id="Process_Rentability" processType="None" isClosed="false" isExecutable="true">
    <bpmn:laneSet id="LaneSet_1">
      <bpmn:lane id="Lane_Manager" name="Менеджер">
        <bpmn:flowNodeRef>StartEvent_1</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_CreateOrder</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_System" name="Контроль рентабельности 1С:УТ">
        <bpmn:flowNodeRef>Task_CheckNPSS</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_NPSS</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_Approved</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_Rejected</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_AutoOK</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_Result</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>CallActivity_Approval</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_AutoApprove</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_Rent</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_CalcRent</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Block</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_Block</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_1</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="Task_CreateOrder" name="Создать Заказ клиента">
      <bpmn:incoming>Flow_1</bpmn:incoming>
      <bpmn:outgoing>Flow_2</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Task_CheckNPSS" name="Проверка НПСС (возраст &#60; 90 дн)">
      <bpmn:incoming>Flow_2</bpmn:incoming>
      <bpmn:outgoing>Flow_3</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_NPSS">
      <bpmn:incoming>Flow_3</bpmn:incoming>
      <bpmn:outgoing>Flow_Expired</bpmn:outgoing>
      <bpmn:outgoing>Flow_Valid</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_CreateOrder" />
    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_CreateOrder" targetRef="Task_CheckNPSS" />
    <bpmn:sequenceFlow id="Flow_3" sourceRef="Task_CheckNPSS" targetRef="Gateway_NPSS" />
    <bpmn:sequenceFlow id="Flow_Expired" name="устарела" sourceRef="Gateway_NPSS" targetRef="Task_Block">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${npssExpired == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_BlockEnd" sourceRef="Task_Block" targetRef="EndEvent_Block" />
    <bpmn:sequenceFlow id="Flow_Valid" name="актуальна" sourceRef="Gateway_NPSS" targetRef="Task_CalcRent">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${npssExpired == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_5" sourceRef="Task_CalcRent" targetRef="Gateway_Rent" />
    <bpmn:sequenceFlow id="Flow_Positive" name="≥ 0%" sourceRef="Gateway_Rent" targetRef="Task_AutoApprove">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${profitability &gt;= 0}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_AutoEnd" sourceRef="Task_AutoApprove" targetRef="EndEvent_AutoOK" />
    <bpmn:sequenceFlow id="Flow_Negative" name="&#60; 0%" sourceRef="Gateway_Rent" targetRef="CallActivity_Approval">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${profitability &lt; 0}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_7" sourceRef="CallActivity_Approval" targetRef="Gateway_Result" />
    <bpmn:sequenceFlow id="Flow_Yes" name="да" sourceRef="Gateway_Result" targetRef="EndEvent_Approved">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_No" name="нет" sourceRef="Gateway_Result" targetRef="EndEvent_Rejected">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="EndEvent_Approved" name="Согласовано">
      <bpmn:incoming>Flow_Yes</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="EndEvent_Rejected" name="Отклонено">
      <bpmn:incoming>Flow_No</bpmn:incoming>
      <bpmn:errorEventDefinition id="ErrorDef_Rejected" />
    </bpmn:endEvent>
    <bpmn:endEvent id="EndEvent_AutoOK" name="Заказ согласован">
      <bpmn:incoming>Flow_AutoEnd</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_Result">
      <bpmn:incoming>Flow_7</bpmn:incoming>
      <bpmn:outgoing>Flow_Yes</bpmn:outgoing>
      <bpmn:outgoing>Flow_No</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:callActivity id="CallActivity_Approval" name="Согласование (см. BPMN 2)">
      <bpmn:incoming>Flow_Negative</bpmn:incoming>
      <bpmn:outgoing>Flow_7</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:serviceTask id="Task_AutoApprove" name="Авто-согласование">
      <bpmn:incoming>Flow_Positive</bpmn:incoming>
      <bpmn:outgoing>Flow_AutoEnd</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_Rent">
      <bpmn:incoming>Flow_5</bpmn:incoming>
      <bpmn:outgoing>Flow_Positive</bpmn:outgoing>
      <bpmn:outgoing>Flow_Negative</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Task_CalcRent" name="Расчет рентабельности">
      <bpmn:incoming>Flow_Valid</bpmn:incoming>
      <bpmn:outgoing>Flow_5</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Task_Block" name="Блокировка (обновить НПСС)">
      <bpmn:incoming>Flow_Expired</bpmn:incoming>
      <bpmn:outgoing>Flow_BlockEnd</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_Block" name="Заблокирован">
      <bpmn:incoming>Flow_BlockEnd</bpmn:incoming>
      <bpmn:errorEventDefinition id="ErrorDef_Block" />
    </bpmn:endEvent>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1">
      <bpmndi:BPMNShape id="Participant_Pool_di" bpmnElement="Participant_Pool" isHorizontal="true">
        <dc:Bounds x="130" y="80" width="1130" height="520" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_System_di" bpmnElement="Lane_System" isHorizontal="true">
        <dc:Bounds x="160" y="240" width="1100" height="360" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_Manager_di" bpmnElement="Lane_Manager" isHorizontal="true">
        <dc:Bounds x="160" y="80" width="1100" height="160" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1" bioc:stroke="#205022" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#205022">
        <dc:Bounds x="222" y="142" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_CreateOrder_di" bpmnElement="Task_CreateOrder" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="290" y="120" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_CheckNPSS_di" bpmnElement="Task_CheckNPSS" bioc:stroke="#0d4372" bioc:fill="#bbdefb" color:background-color="#bbdefb" color:border-color="#0d4372">
        <dc:Bounds x="420" y="300" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_NPSS_di" bpmnElement="Gateway_NPSS" isMarkerVisible="true" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="555" y="315" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Approved_di" bpmnElement="EndEvent_Approved" bioc:stroke="#205022" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#205022">
        <dc:Bounds x="1162" y="402" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1147" y="445" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Rejected_di" bpmnElement="EndEvent_Rejected" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <dc:Bounds x="1162" y="502" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1152" y="545" width="56" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_AutoOK_di" bpmnElement="EndEvent_AutoOK" bioc:stroke="#205022" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#205022">
        <dc:Bounds x="1162" y="322" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1135" y="365" width="90" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Result_di" bpmnElement="Gateway_Result" isMarkerVisible="true" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="1065" y="435" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="CallActivity_Approval_di" bpmnElement="CallActivity_Approval" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="920" y="420" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_AutoApprove_di" bpmnElement="Task_AutoApprove" bioc:stroke="#0d4372" bioc:fill="#bbdefb" color:background-color="#bbdefb" color:border-color="#0d4372">
        <dc:Bounds x="920" y="300" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Rent_di" bpmnElement="Gateway_Rent" isMarkerVisible="true" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="815" y="315" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_CalcRent_di" bpmnElement="Task_CalcRent" bioc:stroke="#0d4372" bioc:fill="#bbdefb" color:background-color="#bbdefb" color:border-color="#0d4372">
        <dc:Bounds x="680" y="300" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Block_di" bpmnElement="Task_Block" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <dc:Bounds x="680" y="420" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Block_di" bpmnElement="EndEvent_Block" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <dc:Bounds x="712" y="532" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="694" y="575" width="73" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">
        <di:waypoint x="258" y="160" />
        <di:waypoint x="290" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">
        <di:waypoint x="340" y="200" />
        <di:waypoint x="340" y="340" />
        <di:waypoint x="420" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_3_di" bpmnElement="Flow_3">
        <di:waypoint x="520" y="340" />
        <di:waypoint x="555" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Expired_di" bpmnElement="Flow_Expired">
        <di:waypoint x="580" y="365" />
        <di:waypoint x="580" y="460" />
        <di:waypoint x="680" y="460" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="613" y="445" width="47" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_BlockEnd_di" bpmnElement="Flow_BlockEnd">
        <di:waypoint x="730" y="500" />
        <di:waypoint x="730" y="532" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Valid_di" bpmnElement="Flow_Valid">
        <di:waypoint x="605" y="340" />
        <di:waypoint x="680" y="340" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="612" y="323" width="53" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_5_di" bpmnElement="Flow_5">
        <di:waypoint x="780" y="340" />
        <di:waypoint x="815" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Positive_di" bpmnElement="Flow_Positive">
        <di:waypoint x="865" y="340" />
        <di:waypoint x="920" y="340" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="883" y="323" width="25" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_AutoEnd_di" bpmnElement="Flow_AutoEnd">
        <di:waypoint x="1020" y="340" />
        <di:waypoint x="1162" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Negative_di" bpmnElement="Flow_Negative">
        <di:waypoint x="840" y="365" />
        <di:waypoint x="840" y="460" />
        <di:waypoint x="920" y="460" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="877" y="445" width="26" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_7_di" bpmnElement="Flow_7">
        <di:waypoint x="1020" y="460" />
        <di:waypoint x="1065" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Yes_di" bpmnElement="Flow_Yes">
        <di:waypoint x="1090" y="435" />
        <di:waypoint x="1090" y="420" />
        <di:waypoint x="1162" y="420" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1116" y="402" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_No_di" bpmnElement="Flow_No">
        <di:waypoint x="1090" y="485" />
        <di:waypoint x="1090" y="520" />
        <di:waypoint x="1162" y="520" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1116" y="502" width="17" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
