{
  "name": "Фиксация потребности",
  "diagramName": "BPMN 11: Фиксация потребности (Этап 2)",
  "description": "Процесс фиксации потребности при дефиците товара и механизм резервирования",
  "lanes": [
    { "id": "manager", "name": "Менеджер", "color": "#dae8fc" },
    { "id": "system", "name": "1С:УТ", "color": "#d5e8d4" },
    { "id": "wms", "name": "WMS / Склад", "color": "#d5e8d4" }
  ],
  "nodes": [
    { "id": "start", "type": "eventStart", "label": "", "lane": "manager" },
    { "id": "t1", "type": "task", "label": "Создание заказа\nпо ЛС", "lane": "manager" },
    { "id": "t2", "type": "task", "label": "Проверка\nналичия товара", "lane": "system" },
    { "id": "x_stock", "type": "gateway", "label": "X", "lane": "system" },
    { "id": "t_full", "type": "task", "label": "100% в наличии\n(стандартный поток)", "lane": "system" },
    { "id": "t_partial", "type": "task", "label": "Частичное наличие\n(разделение заказа)", "lane": "system" },
    { "id": "t_none", "type": "task", "label": "Нет на складе\n(весь заказ в ожидание)", "lane": "system" },
    { "id": "t_fix", "type": "task", "label": "Фиксация\nпотребности\n(дата, позиции, кол-во)", "lane": "system" },
    { "id": "t_wait", "type": "task", "label": "Ожидание\nпоступления\n(макс. 90 дней)", "lane": "system" },
    { "id": "x_arrive", "type": "gateway", "label": "X", "lane": "wms" },
    { "id": "t_arrived", "type": "task", "label": "Товар поступил\n(физ. резерв 48 ч)", "lane": "wms" },
    { "id": "t_notify", "type": "task", "label": "Уведомление\nклиента /\nменеджера", "lane": "system" },
    { "id": "x_confirm", "type": "gateway", "label": "X", "lane": "manager" },
    { "id": "t_confirm", "type": "task", "label": "Подтверждение\n(в течение 5 дней)", "lane": "manager" },
    { "id": "t_cancel", "type": "task", "label": "Отказ /\nтаймаут", "lane": "manager" },
    { "id": "x_expiry", "type": "gateway", "label": "X", "lane": "system" },
    { "id": "t_extend", "type": "task", "label": "Автопродление ЛС\n(5 дней, одноразово\nна позицию)", "lane": "system" },
    { "id": "t_annul", "type": "taskError", "label": "Аннулирование\nфиксации\n(товар в своб. остаток)", "lane": "system" },
    { "id": "end_ok", "type": "eventEnd", "label": "К согласованию", "lane": "system" },
    { "id": "end_cancel", "type": "eventEndError", "label": "Аннулировано", "lane": "system" }
  ],
  "edges": [
    { "from": "start", "to": "t1" },
    { "from": "t1", "to": "t2" },
    { "from": "t2", "to": "x_stock" },
    { "from": "x_stock", "to": "t_full", "label": "100%" },
    { "from": "x_stock", "to": "t_partial", "label": "частично" },
    { "from": "x_stock", "to": "t_none", "label": "0%" },
    { "from": "t_full", "to": "end_ok" },
    { "from": "t_partial", "to": "t_fix" },
    { "from": "t_none", "to": "t_fix" },
    { "from": "t_fix", "to": "t_wait" },
    { "from": "t_wait", "to": "x_arrive" },
    { "from": "x_arrive", "to": "t_arrived", "label": "поступил" },
    { "from": "x_arrive", "to": "t_annul", "label": "90 дней / ЛС\nистекла" },
    { "from": "t_arrived", "to": "t_notify" },
    { "from": "t_notify", "to": "x_confirm" },
    { "from": "x_confirm", "to": "t_confirm", "label": "да" },
    { "from": "x_confirm", "to": "t_cancel", "label": "нет / таймаут" },
    { "from": "t_confirm", "to": "x_expiry" },
    { "from": "x_expiry", "to": "end_ok", "label": "ЛС активна" },
    { "from": "x_expiry", "to": "t_extend", "label": "< 5 дн до\nистечения" },
    { "from": "t_extend", "to": "end_ok" },
    { "from": "t_cancel", "to": "t_annul" },
    { "from": "t_annul", "to": "end_cancel" }
  ],
  "notes": [
    {
      "text": "Антиманипуляция:\nфиксация за < 14 дней -\nтолько если товар\nотсутствовал 60+ дней",
      "position": "top-right"
    }
  ]
}
