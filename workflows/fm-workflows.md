# 🔄 Workflows: Полный цикл работы с ФМ

---

## 1️⃣ Создание новой ФМ

```
┌─────────────────────────────────────────────────────────────────┐
│                    WORKFLOW: Создание ФМ                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Запрос]                                                    │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ fm-analyst.md   │ ← Уточняющие вопросы                      │
│  │ Анализ задачи   │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  [2. Структурирование]                                          │
│      │                                                          │
│      ├──► Notion: Создать страницу ФМ                          │
│      ├──► Notion: Создать записи глоссария                     │
│      └──► Notion: Создать записи требований                    │
│           │                                                     │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │ fm-epc-designer │ ← Описание процесса                       │
│  │ Создание ePC    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Miro: Создать доску                             │
│           └──► Miro: Построить диаграмму                       │
│           │                                                     │
│           ▼                                                     │
│  [3. Ревью]                                                     │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ fm-reviewer.md  │ ← Текст ФМ                                │
│  │ Logic Review    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Отчёт с Issues                                  │
│           └──► Рекомендации                                    │
│           │                                                     │
│           ▼                                                     │
│  [4. Доработка] ◄─── цикл пока есть Critical/High              │
│      │                                                          │
│      ▼                                                          │
│  [5. Публикация]                                                │
│      │                                                          │
│      ├──► Notion: Статус = "Review"                            │
│      └──► Уведомление владельцу                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Начать создание ФМ
/fm create "Название процесса"

# Сгенерировать ePC
/fm epc FM-XXX

# Провести ревью
/fm review FM-XXX

# Опубликовать
/fm publish FM-XXX
```

---

## 2️⃣ Миграция Word → Notion

```
┌─────────────────────────────────────────────────────────────────┐
│                   WORKFLOW: Миграция ФМ                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Загрузка файла]                                            │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ fm-migrator.md  │ ← .docx файл                              │
│  │ Парсинг Word    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Извлечь структуру (заголовки)                   │
│           ├──► Извлечь таблицы                                 │
│           ├──► Извлечь глоссарий                               │
│           ├──► Извлечь требования (по паттерну XX-YY-NNN)      │
│           └──► Извлечь риски                                   │
│           │                                                     │
│           ▼                                                     │
│  [2. Создание в Notion]                                         │
│      │                                                          │
│      ├──► Notion: Страница ФМ                                  │
│      ├──► Notion: N записей глоссария                          │
│      ├──► Notion: M записей требований                         │
│      └──► Notion: K записей рисков                             │
│           │                                                     │
│           ▼                                                     │
│  [3. Создание ePC]                                              │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ fm-epc-designer │ ← Таблица процесса из Word                │
│  │ Создание ePC    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           └──► Miro: Доска + диаграмма                         │
│           │                                                     │
│           ▼                                                     │
│  [4. Валидация]                                                 │
│      │                                                          │
│      ├──► Сравнить количества (Word vs Notion)                 │
│      ├──► Проверить связи                                      │
│      └──► Сформировать отчёт                                   │
│           │                                                     │
│           ▼                                                     │
│  [5. Отчёт о миграции]                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Мигрировать файл
/fm migrate "path/to/file.docx"

# Мигрировать с валидацией
/fm migrate "path/to/file.docx" --validate

# Только извлечь данные (без создания в Notion)
/fm extract "path/to/file.docx"
```

---

## 3️⃣ Logic Review

```
┌─────────────────────────────────────────────────────────────────┐
│                   WORKFLOW: Logic Review                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Загрузка ФМ]                                               │
│      │                                                          │
│      ├──► Notion: Получить страницу ФМ                         │
│      ├──► Notion: Получить требования                          │
│      └──► Miro: Получить ePC (если есть)                       │
│           │                                                     │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │ fm-reviewer.md  │                                           │
│  │                 │                                           │
│  │ ┌─────────────┐ │                                           │
│  │ │ Чек-лист    │ │ ← Проверка по категориям                  │
│  │ └─────────────┘ │                                           │
│  │ ┌─────────────┐ │                                           │
│  │ │ Паттерны    │ │ ← Поиск типовых ошибок                    │
│  │ └─────────────┘ │                                           │
│  │ ┌─────────────┐ │                                           │
│  │ │ Симуляция   │ │ ← Прогон сценариев                        │
│  │ └─────────────┘ │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  [2. Категоризация находок]                                     │
│      │                                                          │
│      ├──► 🔴 CRITICAL (блокеры)                                │
│      ├──► 🟠 HIGH (серьёзные)                                  │
│      ├──► 🟡 MEDIUM (улучшения)                                │
│      └──► 🟢 LOW (косметика)                                   │
│           │                                                     │
│           ▼                                                     │
│  [3. Формирование отчёта]                                       │
│      │                                                          │
│      ├──► Markdown отчёт                                       │
│      └──► Notion: Комментарии к требованиям                    │
│           │                                                     │
│           ▼                                                     │
│  [4. Рекомендации]                                              │
│      │                                                          │
│      └──► Приоритизированный список доработок                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Полный ревью
/fm review FM-XXX

# Ревью только бизнес-правил
/fm review FM-XXX --scope=BR

# Ревью с фокусом на edge cases
/fm review FM-XXX --mode=edge-cases

# Экспресс-ревью (только Critical)
/fm review FM-XXX --quick
```

---

## 4️⃣ Обновление ФМ

```
┌─────────────────────────────────────────────────────────────────┐
│                   WORKFLOW: Обновление ФМ                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Запрос изменений]                                          │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ fm-analyst.md   │ ← Описание изменений                      │
│  │ Анализ влияния  │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Какие разделы затронуты?                        │
│           ├──► Какие требования меняются?                      │
│           └──► Нужно ли обновить ePC?                          │
│           │                                                     │
│           ▼                                                     │
│  [2. Внесение изменений]                                        │
│      │                                                          │
│      ├──► Notion: Обновить страницу                            │
│      ├──► Notion: Обновить/добавить требования                 │
│      └──► Miro: Обновить ePC (если нужно)                      │
│           │                                                     │
│           ▼                                                     │
│  [3. Версионирование]                                           │
│      │                                                          │
│      ├──► Инкремент версии (major.minor.patch)                 │
│      ├──► Запись в историю версий                              │
│      └──► Описание изменений                                   │
│           │                                                     │
│           ▼                                                     │
│  [4. Ревью изменений]                                           │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ fm-reviewer.md  │ ← Только изменённые части                 │
│  │ Delta Review    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  [5. Публикация]                                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Правила версионирования

```
MAJOR.MINOR.PATCH

MAJOR (X.0.0):
- Кардинальное изменение логики
- Новые бизнес-правила
- Изменение scope

MINOR (0.X.0):
- Новые требования
- Изменение существующих требований
- Новые разделы

PATCH (0.0.X):
- Исправление ошибок
- Уточнение формулировок
- Косметические правки
```

### Команды

```bash
# Обновить ФМ
/fm update FM-XXX "Описание изменений"

# Обновить с указанием версии
/fm update FM-XXX --version=1.3.0 "Новая логика санкций"

# Добавить требование
/fm add-req FM-XXX BR "Название" "Описание"

# Обновить ePC
/fm update-epc FM-XXX
```

---

## 5️⃣ Генерация документации

```
┌─────────────────────────────────────────────────────────────────┐
│               WORKFLOW: Генерация документов                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Notion ФМ] ─────┬──► PDF (для согласования)                  │
│                   │                                             │
│                   ├──► Word (для внешних)                      │
│                   │                                             │
│                   ├──► Confluence (корп. wiki)                 │
│                   │                                             │
│                   └──► Презентация (для стейкхолдеров)         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Экспорт в PDF
/fm export FM-XXX --format=pdf

# Экспорт в Word
/fm export FM-XXX --format=docx

# Создать презентацию (ключевые моменты)
/fm present FM-XXX --slides=10
```

---

## 🔧 Интеграция с MCP

### Notion MCP

```javascript
// Создать страницу ФМ
notion.pages.create({
  parent: { database_id: "fm_database_id" },
  properties: {
    "Код": { title: [{ text: { content: "FM-LS-PROFIT" } }] },
    "Версия": { rich_text: [{ text: { content: "1.0.0" } }] },
    "Статус": { select: { name: "Draft" } }
  },
  children: [/* blocks */]
})

// Получить ФМ
notion.pages.retrieve({ page_id: "..." })

// Обновить статус
notion.pages.update({
  page_id: "...",
  properties: { "Статус": { select: { name: "Review" } } }
})
```

### Miro MCP

```javascript
// Создать доску
miro.boards.create({
  name: "FM-LS-PROFIT ePC",
  description: "Диаграмма процесса контроля рентабельности"
})

// Создать фрейм
miro.frames.create({
  boardId: "...",
  title: "TO-BE Process",
  x: 0, y: 0, width: 3000, height: 2000
})

// Создать shape (событие)
miro.shapes.create({
  boardId: "...",
  shape: "hexagon",
  content: "Заказ создан",
  style: { fillColor: "#FFE0B2" }
})
```

### Filesystem

```javascript
// Прочитать Word
fs.readFile("/path/to/FM.docx")

// Записать отчёт
fs.writeFile("/path/to/review-report.md", content)
```
