# 🔄 Workflows: Полный цикл работы с ФМ

---

## 1️⃣ Создание новой ФМ (полный pipeline)

```
┌─────────────────────────────────────────────────────────────────┐
│                    WORKFLOW: Создание ФМ                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ЭТАП 1 — СОЗДАНИЕ (локально)                                  │
│  ┌──────────────────────┐                                      │
│  │ Agent 0 (Creator)    │ ← Уточняющие вопросы / PROJECT_CONTEXT│
│  │ /auto                │ → FM v1.0 (Markdown)                  │
│  └──────────┬───────────┘                                      │
│             ▼                                                   │
│  ЭТАП 2 — ВНУТРЕННИЙ РЕВЬЮ (локально)                          │
│  ┌──────────────────────┐                                      │
│  │ Agent 1 (Architect)  │ → аудит → /apply → FM v1.1           │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Agent 2 (Simulator)  │ → UX → /apply → FM v1.2              │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Agent 4 (QA Tester)  │ → тесты → /apply → FM v1.3           │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Agent 5 (Tech Arch)  │ → архитектура + ТЗ → FM v1.4         │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Quality Gate         │ → проверка готовности                 │
│  └──────────┬───────────┘                                      │
│             ▼                                                   │
│  ЭТАП 3 — ПУБЛИКАЦИЯ (Notion + Miro)                           │
│  ┌──────────────────────┐                                      │
│  │ Agent 7 (Migrator)   │ → создание в Notion (Draft)           │
│  │ /auto                │ → 5 БД заполнены                      │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Agent 8 (EPC Design) │ → ePC в Miro → embed в Notion        │
│  │ /auto                │                                       │
│  └──────────┬───────────┘                                      │
│             ▼                                                   │
│  ЭТАП 4 — БИЗНЕС-СОГЛАСОВАНИЕ (Notion)                         │
│  ┌──────────────────────┐                                      │
│  │ Статус: Draft→Review │ → бизнес читает, комментирует        │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Agent 3 (Defender)   │ → анализ замечаний бизнеса            │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐  ◄── цикл если есть доработки        │
│  │ Agent 0 (Creator)    │ → доработка по замечаниям             │
│  │ Agent 7 /sync        │ → обновление Notion                   │
│  └──────────┬───────────┘                                      │
│  ┌──────────┴───────────┐                                      │
│  │ Статус: → Approved   │                                       │
│  └──────────┬───────────┘                                      │
│             ▼                                                   │
│  ЭТАП 5 — ФИНАЛИЗАЦИЯ                                          │
│  ┌──────────────────────┐                                      │
│  │ Agent 6 (Presenter)  │ → презентация + отчёты                │
│  │ /auto                │                                       │
│  └──────────────────────┘                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# ЭТАП 1: Создание ФМ
/new "Название процесса"

# ЭТАП 2: Внутренний ревью (агенты 1→2→4→5)
/audit

# ЭТАП 3: Публикация
/migrate    # Agent 7 → Notion
/epc        # Agent 8 → Miro

# ЭТАП 4: Бизнес-согласование
# "Отправь ФМ на согласование" → Agent 7 меняет статус
# "Проанализируй замечания" → Agent 3
# "Доработай по замечаниям" → Agent 0 + Agent 7 /sync

# ЭТАП 5: Финализация
/present    # Agent 6 → отчёты
```

---

## 2️⃣ Миграция Word → Notion

```
┌─────────────────────────────────────────────────────────────────┐
│                   WORKFLOW: Миграция ФМ                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Загрузка файла]                                            │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ AGENT_7_MIGRATOR.md  │ ← .docx файл                              │
│  │ Парсинг Word    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Извлечь структуру (заголовки)                   │
│           ├──► Извлечь таблицы                                 │
│           ├──► Извлечь глоссарий                               │
│           ├──► Извлечь требования (по паттерну XX-YY-NNN)      │
│           └──► Извлечь риски                                   │
│           │                                                     │
│           ▼                                                     │
│  [2. Создание в Notion]                                         │
│      │                                                          │
│      ├──► Notion: Страница ФМ                                  │
│      ├──► Notion: N записей глоссария                          │
│      ├──► Notion: M записей требований                         │
│      └──► Notion: K записей рисков                             │
│           │                                                     │
│           ▼                                                     │
│  [3. Создание ePC]                                              │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ AGENT_8_EPC_DESIGNER.md │ ← Таблица процесса из Word                │
│  │ Создание ePC    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           └──► Miro: Доска + диаграмма                         │
│           │                                                     │
│           ▼                                                     │
│  [4. Валидация]                                                 │
│      │                                                          │
│      ├──► Сравнить количества (Word vs Notion)                 │
│      ├──► Проверить связи                                      │
│      └──► Сформировать отчёт                                   │
│           │                                                     │
│           ▼                                                     │
│  [5. Отчёт о миграции]                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Мигрировать файл
/migrate "path/to/file.docx"

# Мигрировать с валидацией
/migrate "path/to/file.docx" --validate

# Только извлечь данные (без создания в Notion)
/extract "path/to/file.docx"
```

---

## 3️⃣ Logic Review

```
┌─────────────────────────────────────────────────────────────────┐
│                   WORKFLOW: Logic Review                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Загрузка ФМ]                                               │
│      │                                                          │
│      ├──► Notion: Получить страницу ФМ                         │
│      ├──► Notion: Получить требования                          │
│      └──► Miro: Получить ePC (если есть)                       │
│           │                                                     │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │ AGENT_1_ARCHITECT.md  │                                           │
│  │                 │                                           │
│  │ ┌─────────────┐ │                                           │
│  │ │ Чек-лист    │ │ ← Проверка по категориям                  │
│  │ └─────────────┘ │                                           │
│  │ ┌─────────────┐ │                                           │
│  │ │ Паттерны    │ │ ← Поиск типовых ошибок                    │
│  │ └─────────────┘ │                                           │
│  │ ┌─────────────┐ │                                           │
│  │ │ Симуляция   │ │ ← Прогон сценариев                        │
│  │ └─────────────┘ │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  [2. Категоризация находок]                                     │
│      │                                                          │
│      ├──► 🔴 CRITICAL (блокеры)                                │
│      ├──► 🟠 HIGH (серьёзные)                                  │
│      ├──► 🟡 MEDIUM (улучшения)                                │
│      └──► 🟢 LOW (косметика)                                   │
│           │                                                     │
│           ▼                                                     │
│  [3. Формирование отчёта]                                       │
│      │                                                          │
│      ├──► Markdown отчёт                                       │
│      └──► Notion: Комментарии к требованиям                    │
│           │                                                     │
│           ▼                                                     │
│  [4. Рекомендации]                                              │
│      │                                                          │
│      └──► Приоритизированный список доработок                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Полный ревью
/audit FM-XXX

# Ревью только бизнес-правил
/audit FM-XXX --scope=BR

# Ревью с фокусом на edge cases
/audit FM-XXX --mode=edge-cases

# Экспресс-ревью (только Critical)
/audit FM-XXX --quick
```

---

## 4️⃣ Обновление ФМ

```
┌─────────────────────────────────────────────────────────────────┐
│                   WORKFLOW: Обновление ФМ                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Запрос изменений]                                          │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ AGENT_0_CREATOR.md   │ ← Описание изменений                      │
│  │ Анализ влияния  │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Какие разделы затронуты?                        │
│           ├──► Какие требования меняются?                      │
│           └──► Нужно ли обновить ePC?                          │
│           │                                                     │
│           ▼                                                     │
│  [2. Внесение изменений]                                        │
│      │                                                          │
│      ├──► Notion: Обновить страницу                            │
│      ├──► Notion: Обновить/добавить требования                 │
│      └──► Miro: Обновить ePC (если нужно)                      │
│           │                                                     │
│           ▼                                                     │
│  [3. Версионирование]                                           │
│      │                                                          │
│      ├──► Инкремент версии (major.minor.patch)                 │
│      ├──► Запись в историю версий                              │
│      └──► Описание изменений                                   │
│           │                                                     │
│           ▼                                                     │
│  [4. Ревью изменений]                                           │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ AGENT_1_ARCHITECT.md  │ ← Только изменённые части                 │
│  │ Delta Review    │                                           │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  [5. Публикация]                                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Правила версионирования

```
MAJOR.MINOR.PATCH

MAJOR (X.0.0):
- Кардинальное изменение логики
- Новые бизнес-правила
- Изменение scope

MINOR (0.X.0):
- Новые требования
- Изменение существующих требований
- Новые разделы

PATCH (0.0.X):
- Исправление ошибок
- Уточнение формулировок
- Косметические правки
```

### Команды

```bash
# Обновить ФМ
/update FM-XXX "Описание изменений"

# Обновить с указанием версии
/update FM-XXX --version=1.3.0 "Новая логика санкций"

# Добавить требование
/add-req FM-XXX BR "Название" "Описание"

# Обновить ePC
/epc-update FM-XXX
```

---

## 5️⃣ Генерация документации

```
┌─────────────────────────────────────────────────────────────────┐
│               WORKFLOW: Генерация документов                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Notion ФМ] ─────┬──► PDF (для согласования)                  │
│                   │                                             │
│                   ├──► Word (для внешних)                      │
│                   │                                             │
│                   ├──► Confluence (корп. wiki)                 │
│                   │                                             │
│                   └──► Презентация (для стейкхолдеров)         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Экспорт в PDF
/export FM-XXX --format=pdf

# Экспорт в Word
/export FM-XXX --format=docx

# Создать презентацию (ключевые моменты)
/present FM-XXX --slides=10
```

---

## 6️⃣ Бизнес-согласование

```
┌─────────────────────────────────────────────────────────────────┐
│              WORKFLOW: Согласование ФМ с бизнесом               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1. Внутренний ревью завершён]                                 │
│      │                                                          │
│      ▼                                                          │
│  Notion: Статус ФМ → "Review" (жёлтый)                         │
│  Notion-страница расшаривается бизнес-заказчику                │
│      │                                                          │
│      ▼                                                          │
│  [2. Бизнес читает ФМ в Notion]                                 │
│      │                                                          │
│      ├──► Оставляет комментарии в Notion                       │
│      └──► Срок: 3 рабочих дня                                  │
│      │                                                          │
│      ▼                                                          │
│  [3. Анализ замечаний]                                          │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────┐                                           │
│  │ AGENT_3_DEFENDER │ ← Замечания из Notion                    │
│  │ Ответ на замечания│                                          │
│  └────────┬────────┘                                           │
│           │                                                     │
│           ├──► Принять (доработать ФМ)                         │
│           └──► Отклонить (с аргументацией)                     │
│      │                                                          │
│      ▼                                                          │
│  [4. Доработка] ◄─── цикл до снятия замечаний                  │
│      │                                                          │
│      ▼                                                          │
│  [5. Согласовано]                                               │
│      │                                                          │
│      ▼                                                          │
│  Notion: Статус ФМ → "Approved" (зелёный)                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Команды

```bash
# Отправить на согласование (статус → Review)
"Отправь ФМ на согласование"

# Проанализировать замечания бизнеса (Agent 3)
"Проанализируй замечания от бизнеса"  → /respond

# Подтвердить согласование (статус → Approved)
"ФМ согласована"

# Проверить статус
"Покажи статус согласования"
```

---

## 🔧 Интеграция с MCP

### Notion MCP (Agent 7 — основной ответственный)

```
# Создать страницу ФМ
notion_create_page(
  parent: {database_id: "fm_database_id"},
  properties: {Код: "FM-LS-PROFIT", Версия: "1.0.0", Статус: "Draft"}
)

# Проверить дубликат перед созданием
notion_search(query: "FM-LS-PROFIT") → если найдено → обновить, не создавать

# Получить ФМ для валидации
notion_retrieve_page(page_id: "...")

# Обновить статус
notion_update_page(page_id: "...", properties: {Статус: "Review"})

# Добавить контент на страницу
notion_append_blocks(block_id: page_id, children: [...])
```

### Miro MCP (Agent 8 — основной ответственный)

```
# Получить DSL-спецификацию
MIRO:diagram_get_dsl(board_id: "...", diagram_type: "flowchart")

# Создать ePC-диаграмму
MIRO:diagram_create(board_id: "...", diagram_dsl: "...", diagram_type: "flowchart")

# Добавить легенду
MIRO:doc_create(board_id: "...", content: "# Легенда ePC\n...")

# Добавить RACI-таблицу
MIRO:table_create(board_id: "...", table_title: "RACI", columns: [...])

# Проверить содержимое доски
MIRO:context_explore(board_url: "https://miro.com/app/board/...")
```

### Filesystem (Claude Code встроенный)

```
# Прочитать Word — через python-docx в Claude Code
# Записать отчёт — через стандартные файловые операции Claude Code
```
