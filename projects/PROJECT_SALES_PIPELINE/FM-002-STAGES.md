# FM-002: Стадии проекта с вероятностями

> **Тематика:** Проектные продажи
> **Версия:** 1.0.0
> **Статус:** Предложение
> **Дата:** 27.01.2026

---

## 1. ПАСПОРТ

| Поле | Значение |
|------|----------|
| Код | FM-PIPE-002 |
| Название | Стадии проекта с вероятностями закрытия |
| Решает проблему | PIPE-C (нет понятного пайплайна на год) |
| Приоритет | HIGH |
| Итерация | 2 |
| Зависит от | FM-001 (воронки) — желательно, не обязательно |

---

## 2. ПРОБЛЕМА (AS-IS)

### 2.1 Текущее состояние

```
Руководители территорий НЕ МОГУТ дать чёткий ответ о запасе к плану.

Пример (Екатеринбург):
- Запас воронки к плану на полугодие: 7%
- При скидке 60% и конверсии 22%
- Это критически мало!
```

### 2.2 Целевое состояние

```
Если хотим сделать 1 млрд в регионе →
должны ВИДЕТЬ 1.5-2 млрд понятных проектов
в сопоставимых (отпускных) ценах.
```

---

## 3. РЕШЕНИЕ (TO-BE)

### 3.1 Концепция

Каждая стадия проекта имеет **вероятность закрытия**. Взвешенный forecast = сумма проектов × вероятности.

```
┌─────────────────────────────────────────────────────────────┐
│  ВОРОНКА С ВЕРОЯТНОСТЯМИ                                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Лид (5%)           ████████████████████████  50 млн        │
│  Квалификация (15%) ██████████████████        30 млн        │
│  Проработка (30%)   ████████████              20 млн        │
│  Предложение (50%)  ████████                  15 млн        │
│  Переговоры (70%)   ██████                    10 млн        │
│  Согласование (90%) ████                       5 млн        │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│  Итого в воронке:              130 млн                      │
│  Взвешенный forecast:           25 млн                      │
│  План:                          20 млн                      │
│  Покрытие:                      125% ✅                     │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 Справочник стадий

| Код | Стадия | Вероятность | Описание | Обязательные поля |
|-----|--------|-------------|----------|-------------------|
| 01 | Лид | 5% | Первичный контакт | Клиент, Контакт |
| 02 | Квалификация | 15% | Потребность подтверждена | + Описание потребности |
| 03 | Проработка | 30% | Готовим предложение | + Бюджет, ЛПР |
| 04 | Предложение | 50% | ТКП отправлено | + ТКП или Смета |
| 05 | Переговоры | 70% | Обсуждаем условия | + Встреча |
| 06 | Согласование | 90% | Договор на подписи | + Проект договора |
| 07 | Закрыт-Выигран | 100% | Подписан | + Подписанный договор |
| 08 | Закрыт-Проигран | 0% | Отказ | + Причина проигрыша |
| 09 | Закрыт-Отменён | 0% | Проект отменён | + Причина отмены |

---

## 4. БИЗНЕС-ПРАВИЛА

### BR-001: Последовательный переход стадий
```
КОГДА: Смена стадии проекта
ПРАВИЛО: Можно перейти только на соседнюю стадию

Разрешено:
  Лид → Квалификация ✅
  Квалификация → Проработка ✅
  Любая → Закрыт-Проигран ✅ (можно с любой)
  Любая → Закрыт-Отменён ✅ (можно с любой)

Запрещено:
  Лид → Предложение ❌ (пропуск стадий)
  Переговоры → Проработка ❌ (откат назад)

ИСКЛЮЧЕНИЕ: Администратор может перевести на любую стадию с комментарием
```

### BR-002: Обязательные поля при переходе
```
КОГДА: Переход на следующую стадию
ЕСЛИ: Не заполнены обязательные поля новой стадии
ТОГДА:
  - Показать ошибку
  - Список незаполненных полей
  - НЕ переводить
```

### BR-003: Расчёт взвешенного forecast
```
Взвешенный_Forecast = Σ (Сумма_проекта × Вероятность_стадии / 100)

Учитываются только проекты:
  - Тип воронки = "Горячая" (если используется FM-001)
  - ИЛИ Стадия ≥ "Проработка" (если FM-001 не используется)
  - Статус ≠ "Закрыт-*"
```

### BR-004: Фиксация истории переходов
```
КОГДА: Любой переход между стадиями
ЗАПИСАТЬ:
  - Проект
  - Дата/время
  - Стадия ИЗ
  - Стадия В
  - Пользователь
  - Комментарий (обязателен для закрытия)
```

### BR-005: Настраиваемые вероятности
```
Вероятности стадий — настраиваемые константы.

По умолчанию: 5% / 15% / 30% / 50% / 70% / 90%

Через 6 месяцев пересчитать на основе факта:
  Факт_вероятность_стадии =
    Кол-во_выигранных_из_стадии / Всего_проектов_на_стадии × 100%
```

---

## 5. ИЗМЕНЕНИЯ В 1С

### 5.1 Справочник "СтадииПроекта"

| Реквизит | Тип | Описание |
|----------|-----|----------|
| Код | Строка(2) | 01, 02, ... |
| Наименование | Строка(50) | Лид, Квалификация, ... |
| ВероятностьПроцент | Число(3,0) | 5, 15, 30, ... |
| Порядок | Число(2,0) | Для сортировки |
| ЭтоЗакрытие | Булево | Для стадий "Закрыт-*" |
| ОбязательныеПоля | Строка | JSON: ["Бюджет", "ЛПР"] |

### 5.2 Справочник "Проекты" — изменения

| Реквизит | Тип | Описание |
|----------|-----|----------|
| Стадия | Справочник.СтадииПроекта | Текущая стадия |
| ДатаПоследнегоПерехода | Дата | Когда сменили стадию |

### 5.3 Регистр сведений "ИсторияСтадийПроекта"

| Измерение | Тип |
|-----------|-----|
| Проект | Справочник.Проекты |
| Период | ДатаВремя |

| Ресурс | Тип |
|--------|-----|
| СтадияИз | Справочник.СтадииПроекта |
| СтадияВ | Справочник.СтадииПроекта |
| Пользователь | Справочник.Пользователи |
| Комментарий | Строка(500) |
| Длительность | Число | Дней на предыдущей стадии |

---

## 6. ИНТЕРФЕЙС

### 6.1 Форма проекта — блок стадии

```
┌─────────────────────────────────────────────────────────────┐
│  Стадия: [Проработка (30%) ▼]                               │
│                                                             │
│  ○ Лид → ○ Квалиф. → ● Проработка → ○ Предлож. → ...       │
│                                                             │
│  [← Вернуть]  [Перевести на следующую →]  [Закрыть проект] │
│                                                             │
│  Для перехода на "Предложение" создайте ТКП или Смету      │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 Канбан-доска (опционально)

```
┌──────────┬──────────┬──────────┬──────────┬──────────┐
│ Лид (5%) │Квалиф.15%│Прораб.30%│Предл.50% │Перег.70% │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ ┌──────┐ │ ┌──────┐ │ ┌──────┐ │ ┌──────┐ │ ┌──────┐ │
│ │Альфа │ │ │Бета  │ │ │Гамма │ │ │Дельта│ │ │Эпсил.│ │
│ │500т  │ │ │1.2м  │ │ │800т  │ │ │2.5м  │ │ │5м    │ │
│ └──────┘ │ └──────┘ │ └──────┘ │ └──────┘ │ └──────┘ │
│ ┌──────┐ │ ┌──────┐ │          │          │          │
│ │Зета  │ │ │Эта   │ │          │          │          │
│ │300т  │ │ │600т  │ │          │          │          │
│ └──────┘ │ └──────┘ │          │          │          │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ 0.8м     │ 1.8м     │ 0.8м     │ 2.5м     │ 5м       │
│ взв: 40т │ взв:270т │ взв:240т │взв:1.25м │взв:3.5м  │
└──────────┴──────────┴──────────┴──────────┴──────────┘
                    Итого взвешенный: 5.3 млн
```

---

## 7. ОТЧЁТЫ

### 7.1 Отчёт "Взвешенный Forecast"

**Группировка:** Регион → Менеджер

| Регион | Менеджер | В воронке | Взвешенный | План | Покрытие |
|--------|----------|-----------|------------|------|----------|
| Москва | Иванов | 25 млн | 8.5 млн | 7 млн | 121% ✅ |
| Москва | Петров | 18 млн | 4.2 млн | 7 млн | 60% ⚠️ |
| СПб | Сидоров | 12 млн | 6.1 млн | 5 млн | 122% ✅ |
| Екб | Козлов | 8 млн | 1.4 млн | 5 млн | 28% ❌ |

**Легенда:**
- ✅ Покрытие ≥ 100%
- ⚠️ Покрытие 70-99%
- ❌ Покрытие < 70%

### 7.2 Отчёт "Конверсия по стадиям"

| Переход | Всего | Успешно | Конверсия | Ср. дней |
|---------|-------|---------|-----------|----------|
| Лид → Квалификация | 100 | 45 | 45% | 5 |
| Квалификация → Проработка | 45 | 30 | 67% | 8 |
| Проработка → Предложение | 30 | 25 | 83% | 12 |
| Предложение → Переговоры | 25 | 18 | 72% | 7 |
| Переговоры → Согласование | 18 | 12 | 67% | 14 |
| Согласование → Выигран | 12 | 10 | 83% | 10 |
| **Общая конверсия** | 100 | 10 | **10%** | 56 |

### 7.3 Отчёт "Застрявшие проекты"

Проекты, которые находятся на стадии дольше среднего × 2:

| Проект | Стадия | Дней на стадии | Среднее | Менеджер |
|--------|--------|----------------|---------|----------|
| ООО "Альфа" | Предложение | 28 | 7 | Иванов |
| ЗАО "Бета" | Переговоры | 45 | 14 | Петров |

---

## 8. ФОРМУЛЫ

### 8.1 Взвешенный forecast

```
Forecast = Σ (Сумма_i × Вероятность_i / 100)

Где:
  Сумма_i — сумма проекта i
  Вероятность_i — вероятность стадии проекта i
```

### 8.2 Покрытие плана

```
Покрытие = Forecast / План × 100%
```

### 8.3 Средняя длительность стадии

```
Ср_длительность = Σ (Дней_на_стадии) / Кол-во_переходов
```

### 8.4 Конверсия стадии

```
Конверсия_стадии = Перешли_на_след / Всего_на_стадии × 100%
```

---

## 9. КОНТРОЛИ И ОГРАНИЧЕНИЯ

| # | Контроль | Уровень | Действие |
|---|----------|---------|----------|
| К-001 | Пропуск стадии | Ошибка | Блокировка |
| К-002 | Откат назад | Ошибка | Блокировка (кроме админа) |
| К-003 | Закрытие без причины | Ошибка | Требовать комментарий |
| К-004 | Незаполненные обяз. поля | Ошибка | Показать список |

---

## 10. ОТКРЫТЫЕ ВОПРОСЫ

| # | Вопрос | Варианты | Рекомендация |
|---|--------|----------|--------------|
| 1 | Разрешить откат на предыдущую стадию? | Да / Нет / Только админ | Только админ |
| 2 | Вероятности настраиваемые? | Да / Нет | Да, пересматривать раз в полгода |
| 3 | Обязательна ли стадия для всех проектов? | Да / Нет | Да, "Лид" по умолчанию |
| 4 | Канбан-доска нужна? | Да / Нет | Желательно, итерация 2+ |

---

## 11. КРИТЕРИИ ПРИЁМКИ

- [ ] Все проекты имеют стадию (Лид по умолчанию)
- [ ] Переход только на соседнюю стадию
- [ ] При переходе проверяются обязательные поля
- [ ] История переходов сохраняется
- [ ] Отчёт "Взвешенный forecast" работает корректно
- [ ] Вероятности настраиваются в справочнике

---

*Мини-ФМ подготовлена как предложение для обсуждения*
