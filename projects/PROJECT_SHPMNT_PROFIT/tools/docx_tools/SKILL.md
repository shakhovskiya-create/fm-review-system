# DOCX Editing Skill (Standalone)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**–°–∫–æ–ø–∏—Ä—É–π –ø–∞–ø–∫—É `docx_tools/` –≤ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤ `~/.local/bin/`:**

```
docx_tools/
‚îú‚îÄ‚îÄ unpack.py       # –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ + merge runs
‚îú‚îÄ‚îÄ pack.py         # –£–ø–∞–∫–æ–≤–∫–∞ + –≤–∞–ª–∏–¥–∞—Ü–∏—è  
‚îú‚îÄ‚îÄ batch_replace.py # –ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–º–µ–Ω—ã
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python 3.6+

## –¢—Ä–∏–≥–≥–µ—Ä

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω–∏—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–≤—å—é .docx —Ñ–∞–π–ª–∞ ‚Äî –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò —Å–ª–µ–¥—É–π —ç—Ç–æ–º—É workflow.

## –í–ê–ñ–ù–û: unpack.py –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ—Ä–∂–∏—Ç split runs

–°–∫—Ä–∏–ø—Ç `unpack.py` **–†–ï–®–ê–ï–¢** –ø—Ä–æ–±–ª–µ–º—É —Ä–∞–∑–±–∏—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ `<w:r>` –±–ª–æ–∫–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- Pretty-print –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç smart quotes –≤ XML entities

**Split runs ‚Äî –ù–ï –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –æ—Ç —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.**

## –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –ò–∑–º–µ–Ω–µ–Ω–∏–π | –°—Ç—Ä–∞—Ç–µ–≥–∏—è |
|-----------|-----------|
| 1-10 | –†—É—á–Ω–æ–π –ø–æ–∏—Å–∫/–∑–∞–º–µ–Ω–∞ –≤ XML |
| 10-50 | batch_replace.py |
| 50+ | batch_replace.py + mapping —Ñ–∞–π–ª |

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

**–ù–ï –û–¢–ö–ê–ó–´–í–ê–ô–°–Ø –æ—Ç XML –ø–æ–¥—Ö–æ–¥–∞** –∏–∑-–∑–∞:
- Split runs ‚Üí unpack.py —É–∂–µ –º–µ—Ä–∂–∏—Ç –∏—Ö
- –ë–æ–ª—å—à–æ–π XML ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π grep/sed, –Ω–µ —á–∏—Ç–∞–π —Ü–µ–ª–∏–∫–æ–º
- –ú–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π batch_replace.py
- –¢–∞–±–ª–∏—Ü—ã ‚Üí –º–µ–Ω—è–π —Ç–æ–ª—å–∫–æ `<w:t>` –≤–Ω—É—Ç—Ä–∏ —è—á–µ–µ–∫

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (python-docx, pandoc) –•–£–ñ–ï** ‚Äî –æ–Ω–∏ –ª–æ–º–∞—é—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

- **–ó–ê–ü–†–ï–©–ï–ù–û:** python-docx, pandoc –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** unpack ‚Üí edit XML ‚Üí pack

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Workflow

### –®–∞–≥ 1: –†–∞—Å–ø–∞–∫–æ–≤–∫–∞

```bash
python docx_tools/unpack.py input.docx ./work/unpacked/
```

–í—ã–≤–æ–¥:
```
üì¶ –†–∞—Å–ø–∞–∫–æ–≤–∫–∞: input.docx
  üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞: word/document.xml
    ‚úì Merged runs: 847 ‚Üí 312
‚úÖ –†–∞—Å–ø–∞–∫–æ–≤–∞–Ω–æ –≤: ./work/unpacked/
   –¢–∞–±–ª–∏—Ü: 5, –ü–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤: 234
```

### –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑

```bash
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞
ls -la ./work/unpacked/word/

# –ü–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–∞
grep -n "–∏—Å–∫–æ–º—ã–π —Ç–µ–∫—Å—Ç" ./work/unpacked/word/document.xml

# –ü–æ–¥—Å—á—ë—Ç –≤—Ö–æ–∂–¥–µ–Ω–∏–π
grep -c "–∏—Å–∫–æ–º—ã–π —Ç–µ–∫—Å—Ç" ./work/unpacked/word/document.xml

# –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–∫—Ä—É–≥ —Å—Ç—Ä–æ–∫–∏ 500
sed -n '495,505p' ./work/unpacked/word/document.xml
```

**–°–æ–æ–±—â–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü
- –ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å
- –°–∫–æ–ª—å–∫–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –Ω–∞–π–¥–µ–Ω–æ

### –®–∞–≥ 3: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ú–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π (1-10)

–ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏–ª–∏ sed:

```bash
# –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞
sed -i '' 's/—Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç/–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç/g' ./work/unpacked/word/document.xml

# –° –±—ç–∫–∞–ø–æ–º
sed -i '.bak' 's/—Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç/–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç/g' ./work/unpacked/word/document.xml
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ú–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π (10+)

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª replacements.py:**

```python
#!/usr/bin/env python3
import sys
sys.path.insert(0, 'docx_tools')
from batch_replace import batch_replace

REPLACEMENTS = [
    ("30 –¥–Ω–µ–π", "45 –¥–Ω–µ–π"),
    ("1–°:ERP", "1–°:ERP 2.5"),
    ("–ó–∞–∫–∞–∑—á–∏–∫", "–ö–ª–∏–µ–Ω—Ç"),
    # ... –≤—Å–µ 32 –∑–∞–º–µ–Ω—ã
]

batch_replace(
    './work/unpacked/word/document.xml',
    REPLACEMENTS,
    use_tracked=True  # False –¥–ª—è —Ç–∏—Ö–æ–π –∑–∞–º–µ–Ω—ã
)
```

**–ó–∞–ø—É—Å—Ç–∏:**
```bash
python replacements.py
```

#### Tracked Changes

–ü—Ä–∏ `use_tracked=True` —Å–æ–∑–¥–∞—ë—Ç—Å—è:
```xml
<w:del w:id="1" w:author="Claude" w:date="2025-01-29T12:00:00Z">
  <w:r><w:rPr>...</w:rPr><w:delText>—Å—Ç–∞—Ä—ã–π</w:delText></w:r>
</w:del>
<w:ins w:id="2" w:author="Claude" w:date="2025-01-29T12:00:00Z">
  <w:r><w:rPr>...</w:rPr><w:t>–Ω–æ–≤—ã–π</w:t></w:r>
</w:ins>
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –í–∞–ª–∏–¥–∞—Ü–∏—è XML (macOS)
xmllint --noout ./work/unpacked/word/document.xml && echo "‚úì XML –≤–∞–ª–∏–¥–Ω—ã–π"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–º–µ–Ω
grep -c "–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç" ./work/unpacked/word/document.xml
```

### –®–∞–≥ 5: –£–ø–∞–∫–æ–≤–∫–∞

```bash
python docx_tools/pack.py ./work/unpacked/ output.docx --original input.docx
```

–í—ã–≤–æ–¥:
```
üì¶ –£–ø–∞–∫–æ–≤–∫–∞: ./work/unpacked/ ‚Üí output.docx
‚úÖ –°–æ–∑–¥–∞–Ω: output.docx
   –†–∞–∑–º–µ—Ä: 156.3 KB
```

### –®–∞–≥ 6: –û—Ç—á—ë—Ç

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –°–û–û–ë–©–ò:**

```
‚úÖ –ì–æ—Ç–æ–≤–æ! –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ document.docx:

1. "30 –¥–Ω–µ–π" ‚Üí "45 –¥–Ω–µ–π" (tracked change, 3 –∑–∞–º–µ–Ω—ã)
2. "1–°:ERP" ‚Üí "1–°:ERP 2.5" (tracked change, 12 –∑–∞–º–µ–Ω)
3. ...

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 32 —Ç–∏–ø–∞ –∑–∞–º–µ–Ω, 87 –≤—Ö–æ–∂–¥–µ–Ω–∏–π

üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç: output.docx

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ Word ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏—è.
```

## –†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

**–ù–ï —á–∏—Ç–∞–π –≤–µ—Å—å XML –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.** –ò—Å–ø–æ–ª—å–∑—É–π:

```bash
# –ü–æ–∏—Å–∫ —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫
grep -n "—Ç–µ–∫—Å—Ç" document.xml | head -20

# –ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–æ–∫–∏ 1000-1020
sed -n '1000,1020p' document.xml

# –ü–æ–¥—Å—á—ë—Ç —Ç–∞–±–ª–∏—Ü
grep -c "<w:tbl>" document.xml

# –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
wc -l document.xml
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

```xml
<w:tbl>
  <w:tblPr>...</w:tblPr>     <!-- –ù–ï –¢–†–û–ì–ê–ô -->
  <w:tblGrid>...</w:tblGrid> <!-- –ù–ï –¢–†–û–ì–ê–ô -->
  <w:tr>                     <!-- —Å—Ç—Ä–æ–∫–∞ -->
    <w:tc>                   <!-- —è—á–µ–π–∫–∞ -->
      <w:tcPr>...</w:tcPr>   <!-- –ù–ï –¢–†–û–ì–ê–ô -->
      <w:p>
        <w:r><w:t>–¢–ï–ö–°–¢</w:t></w:r>  <!-- ‚Üê –ú–û–ñ–ù–û –ú–ï–ù–Ø–¢–¨ -->
      </w:p>
    </w:tc>
  </w:tr>
</w:tbl>
```

**–ü—Ä–∞–≤–∏–ª–æ:** –º–µ–Ω—è–π –¢–û–õ–¨–ö–û `<w:t>` –≤–Ω—É—Ç—Ä–∏ —è—á–µ–µ–∫.

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–∏ tracked changes **–ö–û–ü–ò–†–£–ô `<w:rPr>`:**

```xml
<!-- –û—Ä–∏–≥–∏–Ω–∞–ª -->
<w:r>
  <w:rPr><w:b/><w:sz w:val="28"/></w:rPr>
  <w:t>—Ç–µ–∫—Å—Ç</w:t>
</w:r>

<!-- –° tracked change ‚Äî rPr —Å–æ—Ö—Ä–∞–Ω—ë–Ω -->
<w:del ...>
  <w:r><w:rPr><w:b/><w:sz w:val="28"/></w:rPr><w:delText>—Ç–µ–∫—Å—Ç</w:delText></w:r>
</w:del>
<w:ins ...>
  <w:r><w:rPr><w:b/><w:sz w:val="28"/></w:rPr><w:t>–Ω–æ–≤—ã–π</w:t></w:r>
</w:ins>
```

`batch_replace.py` –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# batch_replace.py —Å–æ–∑–¥–∞—ë—Ç –±—ç–∫–∞–ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
cp ./work/unpacked/word/document.xml.backup ./work/unpacked/word/document.xml

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
python docx_tools/batch_replace.py ./work/unpacked/word/document.xml --restore
```

## Smart Quotes

–ü—Ä–∏ —Ä—É—á–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π XML entities:
- `&#x2019;` ‚Äî –∞–ø–æ—Å—Ç—Ä–æ—Ñ '
- `&#x201C;` ‚Äî –æ—Ç–∫—Ä—ã–≤–∞—é—â–∞—è "
- `&#x201D;` ‚Äî –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è "

## –§–æ—Ä–º—É–ª—ã

**–ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `<m:oMath>` –±–ª–æ–∫–∏** ‚Äî —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –°–æ–æ–±—â–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ —Ñ–æ—Ä–º—É–ª—ã –ª—É—á—à–µ –ø—Ä–∞–≤–∏—Ç—å –≤ Word.

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ pack.py

| –û—à–∏–±–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| durableId overflow | –ê–≤—Ç–æ-–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è |
| Tag imbalance | –ü—Ä–æ–≤–µ—Ä—å –ø–∞—Ä–Ω–æ—Å—Ç—å —Ç–µ–≥–æ–≤ |
| Missing xml:space | –ê–≤—Ç–æ-–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è |

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```bash
# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª
python docx_tools/unpack.py input.docx ./work/
python replacements.py
python docx_tools/pack.py ./work/ output.docx --original input.docx

# –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π
python docx_tools/batch_replace.py ./work/word/document.xml --find "–∏—Å–∫–æ–º—ã–π —Ç–µ–∫—Å—Ç"

# Dry run (–ø–æ–∫–∞–∑–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
python docx_tools/batch_replace.py ./work/word/document.xml --dry-run

# –û—Ç–∫–∞—Ç
python docx_tools/batch_replace.py ./work/word/document.xml --restore
```
