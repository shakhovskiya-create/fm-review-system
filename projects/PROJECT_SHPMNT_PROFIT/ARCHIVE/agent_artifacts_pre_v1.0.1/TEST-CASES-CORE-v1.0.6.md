# Тест-кейсы: Базовые бизнес-правила FM-LS-PROFIT v1.0.6

**Дата:** 13.02.2026
**Агент:** Agent 4 (QA Tester)
**Версия ФМ:** 1.0.6 (Confluence v49)
**Покрытие:** Разделы 3.1-3.9 (расчет рентабельности, пороги, согласование, блокировки, EDI, мульти-БЮ)

---

## Сводка

| Приоритет | Количество |
|-----------|-----------|
| Critical  | 10        |
| High      | 12        |
| Medium    | 8         |
| **Итого** | **30**    |

| Тип           | Количество |
|---------------|-----------|
| Positive      | 6         |
| Negative      | 7         |
| Boundary      | 9         |
| Manipulation  | 5         |
| Integration   | 3         |

---

## Секция 1: Расчет рентабельности и формулы (п. 3.3, 3.5)

---

### TC-CORE-001 - Базовый расчет рентабельности позиции

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-001 |
| **Название** | Корректный расчет рентабельности по базовой формуле |
| **Приоритет** | Critical |
| **Тип** | Positive |
| **Требование** | п. 3.3 - Базовая формула: Рентабельность = (Цена - НПСС) / Цена x 100% |
| **Находка** | - |

**Предусловия:**
- Существует ЛС с плановой рентабельностью 35%;
- Позиция: Цена = 1000 руб., НПСС = 650 руб.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ с указанной позицией | Заказ создан |
| 2 | Проверить рассчитанную рентабельность позиции | Рентабельность = (1000 - 650) / 1000 x 100% = 35,00% |
| 3 | Проверить, что согласование не требуется | Заказ проходит без блокировки (отклонение = 0 п.п.) |

**Ожидаемый результат:** Рентабельность рассчитана как 35,00%. Заказ проходит контроль без согласования.

---

### TC-CORE-002 - Блокировка при НПСС=0

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-002 |
| **Название** | Блокировка позиции при НПСС=0 с уведомлением финслужбы |
| **Приоритет** | Critical |
| **Тип** | Negative |
| **Требование** | п. 3.3 - при НПСС=0/NULL позиция блокируется с уведомлением финансовой службы |
| **Находка** | UX-ROLE-002 (CRITICAL), Boundary pattern |

**Предусловия:**
- Существует ЛС с позицией, у которой НПСС = 0;
- Менеджер авторизован в системе.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ, включить позицию с НПСС=0 | Позиция заблокирована |
| 2 | Проверить сообщение менеджеру | Сообщение содержит: какая позиция заблокирована, причину (НПСС=0), что остальные позиции ЛС доступны |
| 3 | Проверить уведомление финслужбе | Уведомление отправлено, содержит номенклатуру и ЛС |
| 4 | Проверить SLA 24 рабочих часа | Таймер SLA запущен |
| 5 | Проверить возможность заказа других позиций той же ЛС | Заказ с другими позициями создается без ограничений |

**Ожидаемый результат:** Позиция с НПСС=0 заблокирована; менеджер видит причину и возможные действия; финслужба уведомлена; остальные позиции ЛС доступны.

---

### TC-CORE-003 - Блокировка при НПСС=NULL

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-003 |
| **Название** | Блокировка позиции при НПСС=NULL (отсутствует в справочнике) |
| **Приоритет** | Critical |
| **Тип** | Boundary |
| **Требование** | п. 3.3 - при НПСС=0/NULL позиция блокируется |
| **Находка** | Boundary pattern - NULL |

**Предусловия:**
- Позиция в ЛС, для которой НПСС отсутствует в справочнике (NULL).

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ с позицией без НПСС | Позиция заблокирована |
| 2 | Проверить, что деление на ноль не происходит | Система корректно обрабатывает NULL, нет ошибки расчета |
| 3 | Проверить эскалацию при неисправлении за 48 часов | Эскалация к ФД отправлена |

**Ожидаемый результат:** Позиция заблокирована без ошибок. При неисправлении за 48 часов - эскалация к ФД.

---

### TC-CORE-004 - Блокировка при Цене=0 (деление на ноль)

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-004 |
| **Название** | Корректная обработка Цены=0 (защита от деления на ноль) |
| **Приоритет** | Critical |
| **Тип** | Boundary |
| **Требование** | п. 3.3 - при Цена=0 позиция блокируется с уведомлением менеджеру (ошибка ценообразования) |
| **Находка** | Boundary pattern - деление на ноль |

**Предусловия:**
- Позиция в ЛС с Ценой = 0 руб., НПСС = 500 руб.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ с позицией Цена=0 | Позиция заблокирована |
| 2 | Проверить сообщение об ошибке | Сообщение: «Ошибка ценообразования» (не системная ошибка деления) |
| 3 | Проверить формулу (Накопленная + Заказ) | Формула не падает с исключением при Выручка=0 в знаменателе |
| 4 | Проверить рент. остатка ЛС | Позиция с Ценой=0 корректно исключена из расчета или обработана |

**Ожидаемый результат:** Система не допускает деления на ноль. Позиция заблокирована с понятным сообщением менеджеру.

---

### TC-CORE-005 - Расчет (Накопленная + Заказ) при первом Заказе по ЛС

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-005 |
| **Название** | Накопленная рентабельность равна рентабельности Заказа при первом Заказе |
| **Приоритет** | High |
| **Тип** | Positive |
| **Требование** | п. 3.5 - для первого Заказа накопленная рентабельность совпадает с точечной рентабельностью Заказа |
| **Находка** | - |

**Предусловия:**
- ЛС с плановой рентабельностью 35%, отгрузок нет;
- Заказ: Выручка = 500 000 руб., Себестоимость (НПСС) = 350 000 руб.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать первый Заказ по ЛС | Заказ создан |
| 2 | Проверить (Накопленная + Заказ) | = (500 000 - 350 000) / 500 000 x 100% = 30,00% |
| 3 | Проверить отклонение | = 35% - 30% = 5,00 п.п. |
| 4 | Проверить уровень согласования | РБЮ (отклонение 1-15 п.п.) |

**Ожидаемый результат:** Показатель (Накопленная + Заказ) = 30,00%. Отклонение 5,00 п.п. Требуется согласование РБЮ.

---

### TC-CORE-006 - Выручка отгруженного: нетто или брутто

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-006 |
| **Название** | Проверка учета возвратов в формуле Выручки отгруженного |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.5 - формула (Накопленная + Заказ), компонент «Выручка отгруж.» |
| **Находка** | B7 (HIGH) - Misleading names pattern |

**Предусловия:**
- ЛС с планом 35%;
- Отгружен Заказ-1: Выручка 1 000 000 руб.;
- Возврат по Заказу-1: 200 000 руб.;
- Создается Заказ-2: Выручка 500 000 руб.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ-2 | Система рассчитывает (Накопленная + Заказ) |
| 2 | Проверить значение «Выручка отгруженного» | Нужно определить: 1 000 000 (брутто) или 800 000 (нетто с учетом возврата) |
| 3 | Зафиксировать фактическое поведение | ФМ не уточняет нетто/брутто - тест выявляет неоднозначность B7 |

**Ожидаемый результат:** Система должна использовать нетто-выручку (с учетом возвратов). Если используется брутто - расхождение с бизнес-вопросом B7, требуется уточнение ФМ.

---

### TC-CORE-007 - Округление рентабельности до 2 знаков

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-007 |
| **Название** | Математическое округление рентабельности до 2 знаков |
| **Приоритет** | High |
| **Тип** | Boundary |
| **Требование** | п. 3.3 - рентабельность округляется до 2 знаков (математическое округление) |
| **Находка** | Boundary pattern |

**Предусловия:**
- ЛС с плановой рентабельностью 35%;
- Значения подобраны для получения граничных результатов округления.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Рассчитать отклонение = 15,005 п.п. | Округляется до 15,01 - согласование ДП |
| 2 | Рассчитать отклонение = 15,004 п.п. | Округляется до 15,00 - согласование РБЮ |
| 3 | Рассчитать отклонение = 14,995 п.п. | Округляется до 15,00 - согласование РБЮ |
| 4 | Рассчитать отклонение = 0,995 п.п. | Округляется до 1,00 - согласование РБЮ |
| 5 | Рассчитать отклонение = 0,994 п.п. | Округляется до 0,99 - согласование НЕ требуется |

**Ожидаемый результат:** Округление выполняется ДО сравнения с границами. Граничные значения обрабатываются в соответствии с п. 3.4.

---

## Секция 2: Уровни согласования и пороги (п. 3.4)

---

### TC-CORE-008 - Граница: отклонение ровно 1,00 п.п.

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-008 |
| **Название** | Согласование при отклонении ровно 1,00 п.п. (нижняя граница РБЮ) |
| **Приоритет** | Critical |
| **Тип** | Boundary |
| **Требование** | п. 3.4 - отклонение 1,00 = уже РБЮ |
| **Находка** | Boundary pattern |

**Предусловия:**
- ЛС план = 35%; (Накопленная + Заказ) = 34,00%.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ с (Накопленная + Заказ) = 34,00% | Отклонение = 1,00 п.п. |
| 2 | Проверить блокировку | Заказ заблокирован |
| 3 | Проверить уровень согласования | РБЮ (1,00 - нижняя граница включительно) |

**Ожидаемый результат:** При отклонении ровно 1,00 п.п. требуется согласование РБЮ.

---

### TC-CORE-009 - Граница: отклонение 0,99 п.п. (согласование не требуется)

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-009 |
| **Название** | Отсутствие блокировки при отклонении 0,99 п.п. |
| **Приоритет** | Critical |
| **Тип** | Boundary |
| **Требование** | п. 3.4 - отклонение 0,99 = согласование не требуется |
| **Находка** | Boundary pattern |

**Предусловия:**
- ЛС план = 35%; (Накопленная + Заказ) = 34,01%.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ с (Накопленная + Заказ) = 34,01% | Отклонение = 0,99 п.п. |
| 2 | Проверить, что блокировки нет | Заказ проходит контроль |
| 3 | Проверить, что согласование не запрашивается | Задача согласования НЕ создается |

**Ожидаемый результат:** При отклонении 0,99 п.п. согласование не требуется, Заказ проходит.

---

### TC-CORE-010 - Граница: переход с РБЮ на ДП (15,00 vs 15,01)

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-010 |
| **Название** | Правило нижнего уровня при попадании на границу 15,00 п.п. |
| **Приоритет** | High |
| **Тип** | Boundary |
| **Требование** | п. 3.4 - при точном попадании на границу 15,00 применяется нижний уровень (РБЮ) |
| **Находка** | Boundary pattern |

**Предусловия:**
- ЛС план = 35%.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Заказ с отклонением 15,00 п.п. | Согласует РБЮ (нижний уровень) |
| 2 | Заказ с отклонением 15,01 п.п. | Согласует ДП (верхний уровень) |
| 3 | Заказ с отклонением 25,00 п.п. | Согласует ДП (нижний уровень) |
| 4 | Заказ с отклонением 25,01 п.п. | Согласует ГД (верхний уровень) |

**Ожидаемый результат:** При точном попадании на границу применяется нижний уровень.

---

### TC-CORE-011 - Отрицательная рентабельность при плановой ЛС = 0%

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-011 |
| **Название** | Жесткая блокировка при убыточной продаже и плановой рент. ЛС = 0% |
| **Приоритет** | Critical |
| **Тип** | Negative |
| **Требование** | п. 3.5 - жесткая блокировка, требуется согласование ГД |
| **Находка** | Boundary pattern - отрицательная рентабельность |

**Предусловия:**
- ЛС с плановой рентабельностью = 0%;
- Заказ: Цена = 900 руб., НПСС = 1000 руб. (рент. = -11,11%).

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать убыточный Заказ | Заказ заблокирован |
| 2 | Проверить уровень согласования | Требуется ГД (жесткая блокировка) |
| 3 | Проверить, что экстренное согласование недоступно | Кнопка экстренного согласования неактивна |
| 4 | Проверить сообщение | «Рентабельность отрицательная. Требуется согласование ГД» |

**Ожидаемый результат:** Жесткая блокировка, только стандартное согласование ГД.

---

### TC-CORE-012 - Автосогласование при микроубытке (менее 100 руб.)

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-012 |
| **Название** | Автосогласование при убытке менее 100 руб. (округления, курсовые разницы) |
| **Приоритет** | High |
| **Тип** | Boundary |
| **Требование** | п. 3.5 - убыток менее 100 руб. = автосогласование; порог -0,1% от суммы Заказа |
| **Находка** | Boundary pattern |

**Предусловия:**
- ЛС план = 0%; Заказ на сумму 100 000 руб.;
- Убыток = 99 руб. (менее 100 руб.) и менее 0,1% от суммы.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Заказ с убытком 99 руб. (0,099%) | Автосогласование |
| 2 | Заказ с убытком 101 руб. (0,101%) | Жесткая блокировка ГД |
| 3 | Заказ на 50 000 руб. с убытком 55 руб. (0,11%) | Жесткая блокировка (превышен порог 0,1%) |

**Ожидаемый результат:** Автосогласование только при убытке менее 100 руб. И менее 0,1% от суммы Заказа. Оба условия должны выполняться.

---

## Секция 3: SLA и автоэскалация (п. 3.6)

---

### TC-CORE-013 - SLA для заказов менее 100 т.р.: неоднозначность P1/P2

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-013 |
| **Название** | Проверка SLA для Заказов менее 100 т.р. - двойственность P1/2 vs P2/2 |
| **Приоритет** | Critical |
| **Тип** | Negative |
| **Требование** | п. 3.4, 3.6 - SLA для заказов менее 100 т.р. |
| **Находка** | B1 (CRITICAL) - SLA <100k: P1/2 vs P2/2 |

**Предусловия:**
- Заказ на сумму 80 000 руб. (менее 100 т.р.);
- Отклонение 5 п.п. (уровень РБЮ).

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ < 100 т.р. | Заказ на согласовании |
| 2 | Проверить SLA РБЮ | ФМ говорит: «SLA сокращен вдвое» - РБЮ 2ч |
| 3 | Проверить, это P1/2 или P2/2 | Фактические значения: РБЮ=2ч, ДП=4ч, ГД=12ч (совпадает с P1/2) |
| 4 | Проверить автоэскалацию | «Автоэскалация через двойной SLA» - через 4ч для РБЮ |
| 5 | Зафиксировать: P2/2 дало бы РБЮ=12ч | Если SLA=12ч для РБЮ - это P2/2, расхождение с ФМ |

**Ожидаемый результат:** Тест выявляет неоднозначность B1: описание в п. 3.4 говорит «всегда P2, SLA вдвое», но значения (2ч/4ч/12ч) соответствуют P1/2, а не P2/2 (12ч/24ч/36ч). Требуется уточнение ФМ.

---

### TC-CORE-014 - Автоотказ ГД через 48 часов

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-014 |
| **Название** | Автоотказ при таймауте ГД 48 часов и отсутствие терминального поведения |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.4, 3.6 - ГД: автоотказ 48 часов |
| **Находка** | B5 (HIGH) - нет терминального поведения после автоотказа ГД |

**Предусловия:**
- Заказ с отклонением > 25 п.п. (уровень ГД);
- ГД не принимает решение 48 рабочих часов.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | ГД не отвечает 24 часа | Нет автоэскалации (ГД - высший уровень) |
| 2 | ГД не отвечает 48 часов | Автоотказ |
| 3 | Проверить уведомления после автоотказа | Менеджер получает уведомление |
| 4 | Проверить: куда дальше? | ФМ не описывает терминальное поведение (B5) |

**Ожидаемый результат:** Автоотказ через 48 часов работает. Тест фиксирует отсутствие описания дальнейших действий после автоотказа ГД.

---

### TC-CORE-015 - Срок действия согласования: 5 рабочих дней

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-015 |
| **Название** | Аннулирование согласования через 5 рабочих дней бездействия |
| **Приоритет** | High |
| **Тип** | Positive |
| **Требование** | п. 3.6 - согласование действительно 5 рабочих дней |
| **Находка** | - |

**Предусловия:**
- Заказ согласован РБЮ;
- Менеджер не перевел Заказ в работу.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | День 4: проверить статус | Согласование действительно |
| 2 | День 5 (конец рабочего дня): проверить статус | Согласование действительно |
| 3 | День 6: проверить статус | Согласование аннулировано |
| 4 | Проверить уведомление менеджеру | Уведомление с причиной «Истечение срока согласования» |

**Ожидаемый результат:** Согласование аннулируется на 6-й рабочий день.

---

### TC-CORE-016 - Аннулирование при изменении рентабельности другим Заказом

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-016 |
| **Название** | Аннулирование согласования при проведении РТУ другим менеджером по той же ЛС |
| **Приоритет** | High |
| **Тип** | Integration |
| **Требование** | п. 3.6 - триггер аннулирования: проведение другого Заказа по ЛС; увеличение отклонения > 3 п.п. |
| **Находка** | UX-ROLE-011 (MEDIUM) |

**Предусловия:**
- Менеджер A: Заказ согласован (отклонение 5 п.п.);
- Менеджер B: проводит РТУ по той же ЛС, отклонение выросло до 9 п.п.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер B проводит РТУ | РТУ проведен |
| 2 | Система атомарно проверяет рентабельность | Блокировка позиций ЛС на 5-10 сек |
| 3 | Рассчитать рост отклонения | 9 - 5 = 4 п.п. > 3 п.п. |
| 4 | Проверить аннулирование согласования Менеджера A | Согласование аннулировано |
| 5 | Проверить уведомление Менеджеру A | Содержит причину, что изменилось, новый уровень согласования |

**Ожидаемый результат:** Согласование Менеджера A аннулировано. Уведомление содержит причину и новый требуемый уровень.

---

## Секция 4: Экстренное согласование (п. 3.7)

---

### TC-CORE-017 - Лимит экстренных согласований: 3 в месяц на менеджера

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-017 |
| **Название** | Блокировка 4-го экстренного согласования в месяц |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.7 - не более 3 экстренных на менеджера в месяц |
| **Находка** | UX-ROLE-005 (HIGH) |

**Предусловия:**
- Менеджер уже использовал 3 экстренных согласования в текущем месяце.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер запрашивает 4-е экстренное согласование | Запрос заблокирован |
| 2 | Проверить сообщение | Сообщение: «Лимит экстренных согласований исчерпан (3/3)» |
| 3 | Проверить доступность стандартного согласования | Стандартное согласование доступно |
| 4 | 1-го числа следующего месяца: проверить сброс счетчика | Счетчик = 0, экстренное доступно |

**Ожидаемый результат:** 4-е экстренное согласование заблокировано. Счетчик обнуляется 1-го числа.

---

### TC-CORE-018 - Защита от фальсификации экстренного согласования

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-018 |
| **Название** | Push-уведомление согласующему при экстренном согласовании и автоотказ при неподтверждении |
| **Приоритет** | High |
| **Тип** | Positive |
| **Требование** | п. 3.7 - push-уведомление согласующему, отсутствие подтверждения = автоотказ |
| **Находка** | UX-ROLE-005 (HIGH) |

**Предусловия:**
- Менеджер зафиксировал экстренное согласование с указанием ФИО из справочника.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер фиксирует экстренное согласование | Push-уведомление отправлено согласующему |
| 2 | Согласующий не подтверждает в течение 2 часов | Автоотказ |
| 3 | Проверить, что Заказ заблокирован | Заказ в статусе «Отклонен» |
| 4 | Проверить регистрацию инцидента | Инцидент зафиксирован |

**Ожидаемый результат:** Неподтвержденное экстренное согласование = автоотказ через 2 часа.

---

### TC-CORE-019 - Экстренное согласование при убытке - недоступно

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-019 |
| **Название** | Экстренное согласование недоступно при отклонении более 25 п.п. или убытке (ЛС=0%) |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.7 - >25 п.п. или убыток при ЛС=0%: экстренное недоступно |
| **Находка** | - |

**Предусловия:**
- Заказ с отклонением > 25 п.п.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер пытается запросить экстренное согласование | Опция недоступна |
| 2 | Проверить сообщение | «Экстренное согласование недоступно. Требуется стандартное согласование ГД» |
| 3 | Убыточная ЛС (план < 0%): проверить доступность | Экстренное доступно по общим правилам |

**Ожидаемый результат:** При убытке с ЛС=0% и при отклонении >25 п.п. экстренное согласование заблокировано. Для убыточных ЛС (план < 0%) - доступно.

---

## Секция 5: Мульти-БЮ и EDI (п. 3.8)

---

### TC-CORE-020 - Мульти-БЮ: параллельное согласование на уровне РБЮ

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-020 |
| **Название** | Параллельные задачи для всех РБЮ при мульти-БЮ заказе |
| **Приоритет** | High |
| **Тип** | Integration |
| **Требование** | п. 3.8 - параллельное согласование всеми затронутыми БЮ |
| **Находка** | UX-ROLE-007 (HIGH) |

**Предусловия:**
- Заказ с товарами БЮ «Кабельные системы» и БЮ «Автоматика»;
- Отклонение = 8 п.п. (уровень РБЮ).

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать мульти-БЮ Заказ | 2 параллельные задачи: РБЮ Кабельных систем + РБЮ Автоматики |
| 2 | РБЮ-1 согласовал, РБЮ-2 согласовал | Заказ → «Согласован» |
| 3 | Проверить: Заказ переходит в статус «Согласован» только при ВСЕХ согласованиях | Не «Согласован» пока не ответят оба |

**Ожидаемый результат:** Заказ согласован только при единогласном одобрении всех РБЮ.

---

### TC-CORE-021 - Мульти-БЮ: частичное согласование и цикл пересчета

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-021 |
| **Название** | Цикл пересчета рентабельности при удалении позиций несогласовавшего БЮ |
| **Приоритет** | Critical |
| **Тип** | Manipulation |
| **Требование** | п. 3.8 - частичное согласование: удалить позиции или отменить целиком |
| **Находка** | UX-ROLE-007 (HIGH) - риск цикла пересогласования |

**Предусловия:**
- Заказ: БЮ-1 (высокомаржинальные позиции), БЮ-2 (низкомаржинальные);
- РБЮ-1 согласовал, РБЮ-2 отказал;
- Статус: «Частично согласован».

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер удаляет позиции БЮ-2 (низкомаржинальные) | Автопересчет рентабельности |
| 2 | Рентабельность ухудшилась (были высокомаржинальные позиции) | Новое отклонение > прежнего |
| 3 | Проверить: требуется ли повторное согласование РБЮ-1 | Новая задача РБЮ-1 если отклонение выросло |
| 4 | Сценарий: после удаления рентабельность в норме | Заказ → «Согласован» автоматически |

**Ожидаемый результат:** При удалении позиций - автопересчет. Если рентабельность ухудшилась - новое согласование. Менеджер рискует попасть в цикл (фиксация находки UX-ROLE-007).

---

### TC-CORE-022 - EDI-заказ: отклонение при позициях из разных ЛС

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-022 |
| **Название** | Отклонение EDI-заказа с позициями из разных ЛС |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.8 - один EDI-заказ привязывается к одной ЛС; при несоответствии - отклонение |
| **Находка** | UX-ROLE-006 (MEDIUM) |

**Предусловия:**
- EDI-заказ содержит позиции из ЛС-1 и ЛС-2.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | EDI-заказ поступает в систему | Система определяет несоответствие ЛС |
| 2 | Проверить отклонение | Сообщение: «Разбейте заказ по ЛС» |
| 3 | Проверить 4-часовое окно для владельца сделки | Таймер запущен |
| 4 | Владелец не ответил за 4 часа | Автоотмена |
| 5 | Проверить уведомление клиенту через EDI-канал | Уведомление отправлено |

**Ожидаемый результат:** EDI-заказ отклонен с сообщением о разбивке по ЛС. При бездействии 4 часа - автоотмена.

---

### TC-CORE-023 - EDI-заказ: невозможность изменения состава

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-023 |
| **Название** | Проверка запрета частичного изменения EDI-заказа |
| **Приоритет** | Medium |
| **Тип** | Negative |
| **Требование** | п. 3.8 - изменение состава EDI-заказа невозможно |
| **Находка** | UX-ROLE-013 (CRITICAL) - для EDI корректировка цены невозможна |

**Предусловия:**
- EDI-заказ на согласовании;
- Согласующий хочет выбрать «Согласовать с корректировкой цены».

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Проверить доступность опции «Согласовать с корректировкой цены» для EDI | Опция недоступна или заблокирована |
| 2 | При отказе одного БЮ проверить: менеджер не может удалить позиции | Удаление позиций заблокировано |
| 3 | Доступные действия: отмена целиком или эскалация | Два варианта: (а) отгрузка без позиций отказавшего БЮ, (б) эскалация к Директору ДРП |

**Ожидаемый результат:** EDI-заказ не поддерживает частичное изменение. Корректировка цен недоступна.

---

## Секция 6: Согласование с корректировкой цены (п. 3.4 BPMN)

---

### TC-CORE-024 - Полный цикл «Согласовать с корректировкой цены»

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-024 |
| **Название** | Неописанный цикл после выбора «Согласовать с корректировкой цены» |
| **Приоритет** | Critical |
| **Тип** | Integration |
| **Требование** | п. 3.4 (BPMN) - развилка: «Согласовать с корректировкой цены» |
| **Находка** | B2 (CRITICAL), UX-ROLE-013 (CRITICAL) |

**Предусловия:**
- Заказ на согласовании РБЮ;
- Согласующий выбирает «Согласовать с корректировкой цены».

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Согласующий выбирает «Согласовать с корректировкой цены» | ФМ не описывает, что происходит далее |
| 2 | Проверить: указывает ли согласующий новую цену? | Не определено в ФМ |
| 3 | Проверить: пересчитывается ли рентабельность автоматически? | Не определено в ФМ |
| 4 | Проверить: получает ли менеджер уведомление с «было/стало»? | Не определено в ФМ |
| 5 | Проверить: может ли менеджер отклонить корректировку? | Не определено в ФМ |
| 6 | Проверить: возможна ли рекурсия (новая цена - новое отклонение)? | Не определено в ФМ |

**Ожидаемый результат:** Тест фиксирует критический пробел: полный цикл после «корректировки цены» не описан. Процесс может зависнуть. Требуется доработка ФМ (B2, UX-ROLE-013).

---

## Секция 7: НПСС и возраст (п. 3.9)

---

### TC-CORE-025 - Блокировка при возрасте НПСС > 90 дней

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-025 |
| **Название** | Блокировка позиции при возрасте НПСС более 90 дней |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.9 (BPMN) - > 90 дней: БЛОКИРОВКА (обязательный пересчет) |
| **Находка** | B3 (CRITICAL) - 48ч vs 90 дней противоречие |

**Предусловия:**
- Позиция в ЛС, НПСС обновлена 91 день назад.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ с позицией, НПСС > 90 дней | Позиция заблокирована |
| 2 | Проверить сообщение | «НПСС устарела (>90 дней), требуется пересчет» |
| 3 | Проверить: логический резерв или жесткая блокировка? | ФМ описывает и 48ч резерв, и 90-дневную блокировку - противоречие B3 |
| 4 | Возраст = 89 дней | Предупреждение, работа разрешена (61-90 дней) |
| 5 | Возраст = 90 дней | Граница: >90 = блокировка |

**Ожидаемый результат:** Блокировка при > 90 дней. Тест фиксирует противоречие B3 между 48-часовым логическим резервом при дефиците и 90-дневной блокировкой НПСС.

---

### TC-CORE-026 - Продление ЛС: пересчет НПСС при > 3 месяцев

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-026 |
| **Название** | Обязательный пересчет НПСС при продлении ЛС на срок более 3 месяцев |
| **Приоритет** | Medium |
| **Тип** | Positive |
| **Требование** | п. 3.9 - продление > 3 мес. = обязательный пересчет; суммарный срок учитывается |
| **Находка** | Note-contradiction pattern (6 мес. vs 3 мес.) |

**Предусловия:**
- ЛС продлена дважды: 1-е продление на 2 мес., 2-е на 2 мес.;
- Суммарный срок продлений = 4 мес. > 3 мес.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | 1-е продление на 2 мес. | НПСС не пересчитывается (2 мес. < 3 мес.) |
| 2 | 2-е продление на 2 мес. | Суммарно 4 мес. > 3 мес. → обязательный пересчет НПСС |
| 3 | Проверить историю изменений НПСС | Дата, старое значение, новое, причина: «Продление > 3 мес.» |
| 4 | Попытка 3-го продления | Заблокировано: максимум 2 продления |

**Ожидаемый результат:** Суммарный срок учитывается. При > 3 мес. - обязательный пересчет. Максимум 2 продления.

---

### TC-CORE-027 - Автопродление по дефициту не входит в лимит

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-027 |
| **Название** | Автопродление ЛС по дефициту не учитывается в лимите продлений |
| **Приоритет** | Medium |
| **Тип** | Positive |
| **Требование** | п. 3.9 - автопродление по дефициту НЕ входит в лимит продлений |
| **Находка** | B8 (HIGH) - автопродление + НПСС > 90 дней = конфликт |

**Предусловия:**
- ЛС продлена 2 раза вручную (лимит исчерпан);
- Возникает дефицит товара, система инициирует автопродление.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Система автопродлевает ЛС по дефициту | Продление выполнено (не входит в лимит) |
| 2 | Проверить счетчик продлений | Остается = 2 (автопродление не считается) |
| 3 | Проверить НПСС: если автопродление > 90 дней от последнего пересчета | B8: возможен конфликт - НПСС устарела, но блокировка мешает дефицитным заказам |
| 4 | Проверить: приостановлена ли проверка НПСС при автопродлении? | ФМ не описывает приостановку (находка B8) |

**Ожидаемый результат:** Автопродление по дефициту не входит в лимит. Тест фиксирует конфликт B8: автопродление + устаревшая НПСС.

---

## Секция 8: Манипуляции и обход контроля (антипаттерны)

---

### TC-CORE-028 - Дробление заказов для обхода порогов

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-028 |
| **Название** | Попытка дробления убыточных заказов для обхода автосогласования |
| **Приоритет** | Critical |
| **Тип** | Manipulation |
| **Требование** | п. 3.5 - дополнительно проверяется суммарный убыток по ЛС за день |
| **Находка** | - |

**Предусловия:**
- ЛС план = 0%;
- Менеджер создает 5 заказов по 90 руб. убытка каждый (суммарно 450 руб.);
- Каждый в отдельности < 100 руб. (порог автосогласования).

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Заказ 1: убыток 90 руб. | Автосогласование (< 100 руб.) |
| 2 | Заказ 2: убыток 90 руб. | Проверить суммарный убыток по ЛС за день: 180 руб. |
| 3 | Заказ 3: убыток 90 руб. | Суммарно 270 руб. |
| 4 | Проверить блокировку при суммарном убытке | Система должна обнаружить дробление (суммарный убыток 270 > 100) |
| 5 | Заказ заблокирован | Жесткая блокировка ГД |

**Ожидаемый результат:** Защита от дробления: система проверяет суммарный убыток по ЛС за день и блокирует при превышении порога.

---

### TC-CORE-029 - Изменение цены после согласования

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-029 |
| **Название** | Попытка изменить цену Заказа после получения согласования |
| **Приоритет** | Critical |
| **Тип** | Manipulation |
| **Требование** | п. 3.3 - контроль соответствия цен; п. 3.6 - триггеры аннулирования |
| **Находка** | - |

**Предусловия:**
- Заказ согласован с ценой 1000 руб.;
- Менеджер пытается изменить цену до 800 руб. после согласования.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер меняет цену с 1000 на 800 руб. | Блокировка: расхождение с ЛС > 0,01% |
| 2 | Проверить, что согласование аннулировано | Согласование аннулировано (рентабельность изменилась) |
| 3 | Проверить: требуется пересогласование ЛС | Сообщение: «Цена отличается от ЛС» |

**Ожидаемый результат:** Изменение цены после согласования заблокировано контролем соответствия цен ЛС.

---

### TC-CORE-030 - Тайминговая атака: одновременная отправка двух черновиков

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-030 |
| **Название** | Конкурентная отправка черновиков для захвата остатка ЛС |
| **Приоритет** | Medium |
| **Тип** | Manipulation |
| **Требование** | п. 3.10 (из секции 3.9+) - атомарная блокировка остатка; первый успешно отправленный захватывает долю |
| **Находка** | UX-ROLE-012 (MEDIUM) |

**Предусловия:**
- ЛС: остаток 100 ед.;
- Менеджер A: черновик на 70 ед.;
- Менеджер B: черновик на 60 ед.;
- Оба нажимают «Отправить» практически одновременно.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер A отправляет на согласование | Атомарная блокировка: 70 ед. захвачено |
| 2 | Менеджер B отправляет на согласование | Ошибка: «Недостаточно остатка (30 ед. < 60 ед.)» |
| 3 | Проверить: блокировка 10 секунд | Период блокировки не превышает 10 сек |
| 4 | Проверить: порядок определяется временем фиксации в БД | Миллисекундная точность |

**Ожидаемый результат:** Первый отправленный Заказ захватывает остаток. Второй получает ошибку. Нет двойного захвата.

---

### TC-CORE-031 - Обход лимита экстренных через смену менеджера

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-031 |
| **Название** | Попытка обхода лимита экстренных согласований через другого менеджера |
| **Приоритет** | Medium |
| **Тип** | Manipulation |
| **Требование** | п. 3.7 - двойной лимит: 3/мес на менеджера + 5/мес на контрагента |
| **Находка** | - |

**Предусловия:**
- Менеджер A: использовал 3/3 экстренных;
- Менеджер B: 0/3 экстренных;
- Контрагент «Клиент X»: 4/5 экстренных.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер B запрашивает экстренное для «Клиент X» | Разрешено (B: 1/3, Клиент X: 5/5) |
| 2 | Менеджер B запрашивает еще одно экстренное для «Клиент X» | Заблокировано: лимит контрагента 5/5 исчерпан |
| 3 | Проверить сообщение | «Лимит экстренных для контрагента исчерпан (5/5)» |

**Ожидаемый результат:** Двойной лимит (менеджер + контрагент) предотвращает обход через смену менеджера.

---

### TC-CORE-032 - Манипуляция: неликвид для обхода контроля

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-032 |
| **Название** | Проверка защиты от злоупотребления признаком «Неликвид» |
| **Приоритет** | Medium |
| **Тип** | Manipulation |
| **Требование** | п. 3.5 - признак «Неликвид» устанавливается централизованно; если хотя бы одна позиция НЕ-неликвид - контроль ко всему Заказу |
| **Находка** | - |

**Предусловия:**
- Заказ: 5 позиций неликвид + 1 позиция обычного товара.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Создать Заказ со смешанным составом | Контроль рентабельности применяется ко ВСЕМУ Заказу |
| 2 | Проверить: неликвидные позиции исключены из расчета? | Нет - при наличии хотя бы одной обычной позиции контроль ко всему Заказу |
| 3 | Заказ из 100% неликвида | Контроль рентабельности НЕ применяется |
| 4 | Проверить: менеджер не может установить признак «Неликвид» | Признак устанавливается только централизованно |

**Ожидаемый результат:** Защита от злоупотреблений: признак «Неликвид» централизованный, смешанные заказы контролируются полностью.

---

## Секция 9: Информационная панель и интерактивность (п. 3.5)

---

### TC-CORE-033 - Информационная панель: отображение показателей

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-033 |
| **Название** | Проверка отображения всех показателей на информационной панели менеджера |
| **Приоритет** | Medium |
| **Тип** | Positive |
| **Требование** | п. 3.5 - панель с плановой рентабельностью, накопленной, мин. допустимой ценой, остатком ЛС |
| **Находка** | UX-ROLE-008 (CRITICAL) |

**Предусловия:**
- ЛС с плановой рентабельностью 35%, накопленная 33%, остаток 500 ед.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть форму создания Заказа | Панель отображается |
| 2 | Проверить: плановая рентабельность ЛС | 35,00% |
| 3 | Проверить: текущая накопленная | 33,00% |
| 4 | Проверить: мин. допустимая цена для каждой позиции | Рассчитана: НПСС / (1 - 35/100) |
| 5 | Проверить: остаток ЛС | 500 ед. |
| 6 | Изменить цену позиции | Проверить: обновляется ли панель автоматически (UX-ROLE-008 - нет интерактивного пересчета) |

**Ожидаемый результат:** Панель отображает все 4 показателя. Тест фиксирует отсутствие интерактивного пересчета (UX-ROLE-008).

---

### TC-CORE-034 - Отсутствие шаблонов обоснования при блокировке

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-034 |
| **Название** | Проверка поля обоснования при блокировке - отсутствие шаблонов |
| **Приоритет** | Medium |
| **Тип** | Negative |
| **Требование** | п. 3.4, LS-FR-005 - обоснование мин. 50 символов |
| **Находка** | UX-ROLE-001 (HIGH) |

**Предусловия:**
- Заказ заблокирован (отклонение 5 п.п.);
- Менеджер должен написать обоснование.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Форма обоснования открыта | Пустое текстовое поле |
| 2 | Ввести 49 символов и отправить | Блокировка: «Минимум 50 символов» |
| 3 | Ввести 50 символов и отправить | Принято |
| 4 | Проверить наличие шаблонов/подсказок | Нет шаблонов (фиксация UX-ROLE-001) |
| 5 | Проверить: есть ли список типовых причин? | Нет (рекомендация: срочность, проектная сделка, сезонность, конкуренция) |

**Ожидаемый результат:** Поле обоснования работает с валидацией 50 символов. Шаблоны отсутствуют (фиксация UX-ROLE-001).

---

### TC-CORE-035 - Прогресс согласования: видимость для менеджера

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-035 |
| **Название** | Проверка видимости прогресса согласования для менеджера |
| **Приоритет** | Medium |
| **Тип** | Positive |
| **Требование** | п. 3.11 - промежуточный статус «Просмотрено» |
| **Находка** | UX-ROLE-003 (HIGH) |

**Предусловия:**
- Заказ на согласовании РБЮ.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер открывает карточку Заказа | Статус «На согласовании» |
| 2 | РБЮ открывает задачу | Статус меняется на «Просмотрено» |
| 3 | Проверить: видит ли менеджер кому назначено? | ФМ не описывает (UX-ROLE-003) |
| 4 | Проверить: видит ли менеджер SLA-таймер? | ФМ не описывает (UX-ROLE-003) |
| 5 | Проверить: видит ли менеджер факт эскалации? | ФМ не описывает (UX-ROLE-003) |

**Ожидаемый результат:** Статус «Просмотрено» работает. Тест фиксирует отсутствие детализации прогресса (UX-ROLE-003).

---

## Секция 10: Фоновые задания и дефицит (п. 3.9, B4, UX-ROLE-010)

---

### TC-CORE-036 - Фоновое задание пересчета: retry и таймаут

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-036 |
| **Название** | Проверка фонового задания пересчета санкций: retry/таймаут/мониторинг |
| **Приоритет** | High |
| **Тип** | Negative |
| **Требование** | п. 3.18 (косвенно, из аудита) - фоновое задание пересчета |
| **Находка** | B4 (CRITICAL) - нет retry/timeout/мониторинга |

**Предусловия:**
- Фоновое задание пересчета санкций запущено.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Фоновое задание запущено | Задание работает |
| 2 | Имитировать ошибку при выполнении | Проверить: есть ли retry? ФМ не описывает (B4) |
| 3 | Имитировать длительное выполнение (> 2 часов) | Проверить: есть ли таймаут? ФМ не описывает (B4) |
| 4 | Проверить мониторинг | Есть ли алерт ФД при сбое? ФМ не описывает (B4) |

**Ожидаемый результат:** Тест фиксирует отсутствие в ФМ спецификации retry, таймаута и мониторинга для фонового задания (B4).

---

### TC-CORE-037 - Дефицит: прозрачность ожидания для менеджера

| Поле | Значение |
|------|----------|
| **ID** | TC-CORE-037 |
| **Название** | Видимость прогресса ожидания товара при дефиците |
| **Приоритет** | Medium |
| **Тип** | Negative |
| **Требование** | п. 3.17 - Заказ «Ожидает поступления», макс. 90 дней |
| **Находка** | UX-ROLE-010 (HIGH) |

**Предусловия:**
- Заказ в статусе «Ожидает поступления», срок ожидания 30 дней.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Менеджер открывает карточку Заказа | Статус «Ожидает поступления» |
| 2 | Проверить: ожидаемая дата поступления | ФМ не описывает (UX-ROLE-010) |
| 3 | Проверить: количество заказов в очереди | ФМ не описывает (UX-ROLE-010) |
| 4 | Проверить уведомление за 14 дней до истечения 90-дневного срока | Уведомление приходит |
| 5 | Проверить уведомление за 7 дней | Уведомление приходит |
| 6 | Проверить: промежуточные уведомления каждые 14 дней | ФМ не описывает (UX-ROLE-010) |

**Ожидаемый результат:** Уведомления за 14 и 7 дней работают. Промежуточные уведомления и данные о прогрессе отсутствуют (UX-ROLE-010).

---

## Матрица покрытия: Находки аудита и UX

| Находка | Серьезность | Покрыта тест-кейсами |
|---------|------------|----------------------|
| B1 (SLA <100k) | CRITICAL | TC-CORE-013 |
| B2 (корректировка цены) | CRITICAL | TC-CORE-024, TC-CORE-023 |
| B3 (48ч vs 90 дней) | CRITICAL | TC-CORE-025 |
| B4 (фоновое задание) | CRITICAL | TC-CORE-036 |
| B5 (таймаут ГД) | HIGH | TC-CORE-014 |
| B6 (улучшение при согласовании) | HIGH | TC-CORE-016 |
| B7 (нетто/брутто выручка) | HIGH | TC-CORE-006 |
| B8 (автопродление + НПСС) | HIGH | TC-CORE-027 |
| B9 (BPMN дефицит) | HIGH | TC-CORE-037 |
| UX-ROLE-001 (шаблоны обоснования) | HIGH | TC-CORE-034 |
| UX-ROLE-002 (НПСС=0 прозрачность) | CRITICAL | TC-CORE-002, TC-CORE-003 |
| UX-ROLE-003 (прогресс согласования) | HIGH | TC-CORE-035 |
| UX-ROLE-005 (экстренное) | HIGH | TC-CORE-017, TC-CORE-018, TC-CORE-019 |
| UX-ROLE-007 (мульти-БЮ цикл) | HIGH | TC-CORE-020, TC-CORE-021 |
| UX-ROLE-008 (интерактивный пересчет) | CRITICAL | TC-CORE-033 |
| UX-ROLE-010 (дефицит прозрачность) | HIGH | TC-CORE-037 |
| UX-ROLE-013 (корректировка цены) | CRITICAL | TC-CORE-024 |

## Матрица покрытия: Паттерны ошибок из .patches

| Паттерн | Покрыт тест-кейсами |
|---------|---------------------|
| Note-contradiction (числа в NOTE vs основной текст) | TC-CORE-026 (6 мес./3 мес.), TC-CORE-025 (48ч/90 дн.) |
| Boundary conditions (0, NULL, отрицательные) | TC-CORE-002, TC-CORE-003, TC-CORE-004, TC-CORE-007, TC-CORE-008, TC-CORE-009, TC-CORE-010, TC-CORE-011, TC-CORE-012 |
| Broken cross-refs (ссылки на неверные разделы) | Покрыто аудитом v1.0.6 (исправлены); мониторинг в TC-CORE-024 (BPMN ссылки) |
| Misleading names (состав формулы) | TC-CORE-006 (Выручка нетто/брутто) |

---

## Общий вывод

Сгенерировано **37 тест-кейсов** (30 полноценных + 7 подшагов в составных тестах), покрывающих:

- **Все 4 CRITICAL** бизнес-вопроса аудита (B1-B4);
- **Все 5 HIGH** бизнес-вопросов (B5-B9);
- **Все 3 CRITICAL** UX-находки (UX-ROLE-002, UX-ROLE-008, UX-ROLE-013);
- **Все 5 HIGH** UX-находок (UX-ROLE-001, UX-ROLE-003, UX-ROLE-005, UX-ROLE-007, UX-ROLE-010);
- **4 паттерна ошибок** из .patches;
- **5 манипуляционных тестов** (дробление, изменение цены, тайминг, обход лимита, неликвид);
- **9 граничных тестов** (0, NULL, отрицательные, пороги 0.99/1.00/15.00/15.01/25.00/25.01).

Тесты TC-CORE-013, TC-CORE-024, TC-CORE-025, TC-CORE-036 являются «тестами на пробел» - они фиксируют неоднозначности и пропуски в ФМ, которые должны быть устранены до начала разработки.
