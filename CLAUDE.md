# CLAUDE.md — Правила работы с системой FM Review Agents

> Этот файл читается Claude Code автоматически при работе с проектом.

---

## 🎯 О СИСТЕМЕ

Это система из 9 агентов для полного жизненного цикла Функциональных Моделей (ФМ) для проектов 1С: создание, проверка, миграция в Notion, визуализация ePC в Miro.

**Файлы агентов:**
- `agents/AGENT_0_CREATOR.md` — создание ФМ с нуля
- `agents/AGENT_1_ARCHITECT.md` — полный аудит ФМ (бизнес + 1С)
- `agents/AGENT_2_ROLE_SIMULATOR.md` — симуляция ролей
- `agents/AGENT_3_DEFENDER.md` — защита от замечаний
- `agents/AGENT_4_QA_TESTER.md` — генерация тестов
- `agents/AGENT_5_TECH_ARCHITECT.md` — проектирование и ТЗ
- `agents/AGENT_6_PRESENTER.md` — презентации, экспорт в Notion/Miro
- `agents/AGENT_7_MIGRATOR.md` — миграция Word → Notion (5 БД, шаблоны, валидация)
- `agents/AGENT_8_EPC_DESIGNER.md` — ePC-диаграммы в Miro (нотация, цвета, связи)

**Notion/Miro ресурсы:**
- `schemas/notion-databases.md` — JSON-схемы 5 БД Notion (Функциональные модели, Требования, Глоссарий, Риски, История версий)
- `templates/fm-notion-page.md` — шаблон Notion-страницы ФМ
- `templates/requirement-template.md` — шаблон требования
- `templates/glossary-risks-template.md` — шаблон глоссария и рисков
- `workflows/fm-workflows.md` — 5 сквозных сценариев (create, migrate, review, update, export)

**Документация:**
- `README.md` — описание системы
- `docs/PROMPTS.md` — промпты для запуска агентов
- `docs/CHANGELOG.md` — история изменений
- `docs/CHAT_CONTEXT.md` — подробный контекст всех чатов (для восстановления)
- `docs/TODOS.md` — реалтайм-трекер задач

**Рабочие файлы (обновляются автоматически):**
- `docs/PROJECT_CONTEXT.md` — контекст проекта, находки, решения
- `docs/WORKPLAN.md` — план работ, статус задач

---

## 🗣️ NATURAL LANGUAGE ROUTER

```
┌─────────────────────────────────────────────────────────────┐
│  ПОЛЬЗОВАТЕЛЬ ГОВОРИТ НА ЕСТЕСТВЕННОМ ЯЗЫКЕ.               │
│  CLAUDE CODE ОПРЕДЕЛЯЕТ АГЕНТА АВТОМАТИЧЕСКИ.              │
└─────────────────────────────────────────────────────────────┘

МАРШРУТИЗАЦИЯ ПО КЛЮЧЕВЫМ ФРАЗАМ:

"Создай ФМ для...", "Новая ФМ", "Давай опишем процесс..."
  → Agent 0 (Creator) → /new

"Запусти аудит", "Проверь ФМ", "Какие проблемы в ФМ?"
  → Agent 1 (Architect) → /audit

"Как это будет для пользователя?", "Покажи UX", "Симулируй..."
  → Agent 2 (Simulator) → /simulate-all

"Вот замечания от бизнеса", "Проанализируй замечания", "Ответь на..."
  → Agent 3 (Defender) → /respond

"Создай тесты", "Какие тест-кейсы?", "Протестируй ФМ"
  → Agent 4 (QA) → /generate-all

"Спроектируй архитектуру", "Как это реализовать в 1С?", "Сделай ТЗ"
  → Agent 5 (Tech Architect) → /full

"Подготовь презентацию", "Отчёт для руководства", "Резюме проекта"
  → Agent 6 (Presenter) → /present

"Мигрируй в Notion", "Опубликуй ФМ", "Создай в Notion"
  → Agent 7 (Migrator) → /migrate

"Создай ePC", "Нарисуй диаграмму", "Схема процесса в Miro"
  → Agent 8 (EPC Designer) → /epc

"Отправь на согласование", "Статус согласования"
  → Бизнес-согласование workflow (см. секцию ниже)

"Полный цикл", "Запусти всё", "Конвейер"
  → Pipeline: Agent 0 → 7 → 1-5 → 8 → 6

ЕСЛИ НЕПОНЯТНО — спроси: "Уточните: вы хотите [вариант 1] или [вариант 2]?"
```

---

## 📋 ОБЩИЕ ПРАВИЛА ДЛЯ ВСЕХ АГЕНТОВ

### 1. Диалоговый режим

```
┌─────────────────────────────────────────────────────────────┐
│  ИНТЕРВЬЮ = ЖИВОЙ ДИАЛОГ, НЕ АНКЕТА!                       │
├─────────────────────────────────────────────────────────────┤
│  ❌ НЕ ДЕЛАТЬ:                                              │
│     - Выдавать все вопросы сразу                           │
│     - Формировать таблицы с вопросами                      │
│     - Показывать "план интервью"                           │
│                                                             │
│  ✅ ДЕЛАТЬ:                                                  │
│     - Задавать 1-2 вопроса за раз                          │
│     - Ждать ответа                                          │
│     - Уточнять если ответ неполный                         │
│     - Переходить к следующему только после ответа          │
└─────────────────────────────────────────────────────────────┘
```

### 2. Формат вопросов — ИНТЕРАКТИВНОЕ МЕНЮ

```
┌─────────────────────────────────────────────────────────────┐
│  КАЖДЫЙ ВОПРОС = МЕНЮ С ВАРИАНТАМИ                         │
├─────────────────────────────────────────────────────────────┤
│  ❌ НЕ ДЕЛАТЬ:                                              │
│     - Открытые вопросы без вариантов                       │
│     - Checkbox стиль (☐ ☑)                                 │
│     - Длинные текстовые объяснения перед вопросом          │
│                                                             │
│  ✅ ДЕЛАТЬ:                                                  │
│     - Пронумерованные варианты (1, 2, 3...)                │
│     - Один вариант помечен ⭐ РЕКОМЕНДУЕТСЯ                 │
│     - Последний вариант всегда "Другое"                    │
│     - После меню — краткое обоснование рекомендации        │
│     - Пользователь вводит только номер или свой текст      │
└─────────────────────────────────────────────────────────────┘
```

**ШАБЛОН ВОПРОСА:**

```
? [Краткий вопрос]

1. [Вариант]
2. [Вариант] ⭐ рекомендуется  
3. [Вариант]
4. Другое (напишите)

💡 Почему [N]: [1-2 предложения обоснования]

Ваш выбор (1-4):
```

**ПРИМЕРЫ:**

```
? Что в приоритете?

1. Скорость — не тормозить продажи
2. Баланс скорости и контроля ⭐ рекомендуется
3. Контроль — максимальная защита
4. Другое (напишите)

💡 Почему 2: Для торговли обычно нужен баланс — быстрые плюсовые сделки, но контроль минусовых.

Ваш выбор (1-4):
```

```
? Какие изменения применить?

1. Все (11 правок)
2. CRITICAL + HIGH (7 правок) ⭐ рекомендуется
3. Только CRITICAL (4 правки)
4. Конкретные номера (укажите какие)
5. Пока не применять

💡 Почему 2: MEDIUM и LOW можно отложить, критичные и важные лучше исправить сразу.

Ваш выбор (1-5):
```

```
? Как обрабатывать молчание согласующего (4 часа)?

1. Молчание = отказ (безопасно, но тормозит)
2. Молчание = согласие для рент≥0% ⭐ рекомендуется
3. Молчание = эскалация руководителю
4. Другое (напишите)

💡 Почему 2: Плюсовые сделки не должны ждать — автосогласование ускоряет 80% заказов.

Ваш выбор (1-4):
```

**ПРАВИЛО:** Пользователь должен иметь возможность ответить ОДНОЙ цифрой или коротким текстом. Не заставляй писать развёрнутые ответы.

### 3. Правило формата ФМ

```
┌─────────────────────────────────────────────────────────────┐
│  ПРИ РЕДАКТИРОВАНИИ ФМ:                                     │
│                                                             │
│  ❌ НЕЛЬЗЯ без явного указания:                             │
│     - Менять структуру документа                            │
│     - Менять оформление (шрифты, отступы, стили)           │
│     - Менять формат таблиц                                  │
│     - Переименовывать разделы                               │
│     - Менять нумерацию                                      │
│                                                             │
│  ✅ МОЖНО:                                                   │
│     - Менять СОДЕРЖАНИЕ (текст, правила, логику)           │
│     - Добавлять новые пункты В СУЩЕСТВУЮЩЕМ формате        │
│     - Исправлять ошибки в тексте                           │
│                                                             │
│  Если нужно изменить формат — СНАЧАЛА СПРОСИ!              │
└─────────────────────────────────────────────────────────────┘
```

### 3.1. ИНСТРУМЕНТЫ ДЛЯ РАБОТЫ С DOCX (ОБЯЗАТЕЛЬНО!)

```
┌─────────────────────────────────────────────────────────────┐
│  ОСНОВНОЙ ИНСТРУМЕНТ: .NET OpenXML SDK                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  РАСПОЛОЖЕНИЕ:                                              │
│     PROJECT_*/tools/NET/                                    │
│     - SKILL.md          ← полная инструкция                │
│     - DocxTools.csproj  ← .NET проект                      │
│     - Program.cs        ← команды: replace, batch, info    │
│                                                             │
│  ПОДРОБНАЯ ИНСТРУКЦИЯ:                                      │
│     Читай PROJECT_*/tools/NET/SKILL.md                     │
│                                                             │
│  ПРЕИМУЩЕСТВА:                                              │
│     ✅ Microsoft OpenXML SDK — официальный инструмент      │
│     ✅ 100% сохранение форматирования                      │
│     ✅ Полная поддержка tracked changes                    │
│     ✅ Работа с комментариями Word                         │
│     ✅ Изменение таблиц, стилей, метаданных               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**БЫСТРЫЕ КОМАНДЫ:**

Запускать из директории проекта (например, `PROJECT_SHPMNT_PROFIT/`):

```bash
# Информация о документе
dotnet run --project ./tools/NET -- info ./FM_DOCUMENTS/FILE.docx

# Поиск текста
dotnet run --project ./tools/NET -- find ./FM_DOCUMENTS/FILE.docx "текст"

# Замена с tracked changes
dotnet run --project ./tools/NET -- replace \
    ./FM_DOCUMENTS/FILE.docx \
    "старый" "новый" \
    --tracked \
    --author "Шаховский А.С."

# Массовые замены из JSON
cat > ./tools/NET/changes.json << 'EOF'
{
    "старый текст 1": "новый текст 1",
    "старый текст 2": "новый текст 2"
}
EOF

dotnet run --project ./tools/NET -- batch \
    ./FM_DOCUMENTS/FILE.docx \
    ./tools/NET/changes.json \
    --tracked \
    --author "Шаховский А.С." \
    --output ./FM_DOCUMENTS/FILE-v1.1.docx

# Принять все tracked changes
dotnet run --project ./tools/NET -- accept \
    ./FM_DOCUMENTS/FILE.docx \
    --output ./FM_DOCUMENTS/FILE-clean.docx
```

**ПРАВИЛА ИСПОЛЬЗОВАНИЯ:**

```
┌─────────────────────────────────────────────────────────────┐
│  .NET OpenXML SDK (PROJECT_*/tools/NET/):                   │
│  ✅ Текстовые замены любой сложности                        │
│  ✅ Tracked changes (пользователь видит изменения в Word)   │
│  ✅ Массовые замены через JSON файл                         │
│  ✅ Комментарии Word                                        │
│  ✅ 100% сохранение форматирования                          │
│                                                             │
│  ОБЯЗАТЕЛЬНО:                                               │
│  ✅ ВСЕГДА использовать --tracked для видимых изменений     │
│  ✅ ВСЕГДА указывать --author "Шаховский А.С."             │
│  ✅ ВСЕГДА использовать --output для новой версии          │
│  ✅ ВСЕГДА проверять результат через info до и после       │
│  ✅ ВСЕГДА создавать бэкап перед правками                  │
│                                                             │
│  ЗАПРЕЩЕНО:                                                 │
│  ❌ НИКОГДА не использовать python-docx для редактирования │
│  ❌ НИКОГДА не использовать Pandoc (ломает форматирование) │
│  ❌ НИКОГДА не редактировать XML напрямую (сложные правки) │
└─────────────────────────────────────────────────────────────┘
```

**ПРИМЕР ПОЛНОГО WORKFLOW:**

```bash
# Задача: применить 10 исправлений к FM-LS-PROFIT-v1.2.0.docx

# 1. Проверяем исходный документ
cd PROJECT_SHPMNT_PROFIT
dotnet run --project ./tools/NET -- info ./FM_DOCUMENTS/FM-LS-PROFIT-v1.2.0.docx

# 2. Создаем JSON с заменами
cat > ./tools/NET/changes.json << 'EOF'
{
    "race condition": "конфликт параллельных операций",
    "30 дней": "45 дней",
    "1С:ERP": "1С:ERP 2.5"
}
EOF

# 3. Применяем замены с tracked changes
dotnet run --project ./tools/NET -- batch \
    ./FM_DOCUMENTS/FM-LS-PROFIT-v1.2.0.docx \
    ./tools/NET/changes.json \
    --tracked \
    --author "Шаховский А.С." \
    --output ./FM_DOCUMENTS/FM-LS-PROFIT-v1.2.1-DRAFT.docx

# 4. Проверяем результат
dotnet run --project ./tools/NET -- info ./FM_DOCUMENTS/FM-LS-PROFIT-v1.2.1-DRAFT.docx

# 5. Открываем в Word для проверки tracked changes
# 6. После одобрения — принимаем изменения и переименовываем в v1.2.1.docx
```

**КРИТИЧНО:**
- ✅ ВСЕГДА использовать .NET OpenXML SDK из PROJECT_*/tools/NET/
- ✅ ВСЕГДА tracked changes (--tracked --author "Шаховский А.С.")
- ✅ ВСЕГДА проверять результат (info + открыть в Word)
- ✅ ВСЕГДА создавать бэкап перед правками
- ❌ НИКОГДА не использовать python-docx, Pandoc, XML напрямую

### 3.5. Правила текста и форматирования (ОБЯЗАТЕЛЬНО!)

```
┌─────────────────────────────────────────────────────────────┐
│  ПРАВИЛА ОФОРМЛЕНИЯ ТЕКСТА В ДОКУМЕНТАХ:                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. ТИРЕ И ДЕФИСЫ:                                          │
│     ❌ НИКОГДА не использовать длинное тире (—)             │
│     ✅ ВСЕГДА использовать обычный дефис (-)                │
│     Пример: "Заказ - это документ" (НЕ "Заказ — это...")   │
│                                                             │
│  2. БУКВА Ё:                                                │
│     ❌ НИКОГДА не использовать букву "ё"                    │
│     ✅ ВСЕГДА заменять на "е"                               │
│     Пример: "Отчеты" (НЕ "Отчёты"), "Расчеты" (НЕ "Расчёты")│
│                                                             │
│  3. ПУНКТУАЦИЯ В СПИСКАХ:                                   │
│     ✅ В перечислениях использовать точку с запятой (;)     │
│     ✅ В конце последнего элемента - точку (.)              │
│     Пример:                                                 │
│       - Первый пункт;                                       │
│       - Второй пункт;                                       │
│       - Последний пункт.                                    │
│                                                             │
│  4. ГРАММАТИКА И ПУНКТУАЦИЯ:                                │
│     ✅ Постоянно проверять грамматику ОЧЕНЬ тщательно       │
│     ✅ Проверять пунктуацию в каждом предложении            │
│     ✅ Избегать канцелярита и технических терминов          │
│     ✅ Писать для бизнеса, не для программистов             │
│                                                             │
│  5. СТИЛЬ ИЗЛОЖЕНИЯ:                                        │
│     ✅ Простой, понятный язык                               │
│     ✅ Короткие предложения                                 │
│     ❌ Избегать: "является единственным источником истины"  │
│     ✅ Использовать: "используется для принятия решений"    │
│                                                             │
│  ⚠️  ЭТИ ПРАВИЛА ПРИМЕНЯЮТСЯ КО ВСЕМ ДОКУМЕНТАМ!           │
└─────────────────────────────────────────────────────────────┘

### 12. Язык и терминология в ФМ

┌─────────────────────────────────────────────────────────────┐
│  ПРАВИЛО: ТОЛЬКО РУССКИЙ ЯЗЫК, БЕЗ АНГЛИЦИЗМОВ             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ❌ ЗАПРЕЩЕНО использовать:                                 │
│     - Англицизмы: race condition, deadlock, timeout         │
│     - Технический сленг: дебаг, коммит, пуш, merge         │
│     - IT-термины: callback, workflow, pipeline              │
│                                                             │
│  ✅ ИСПОЛЬЗОВАТЬ русские эквиваленты:                       │
│     - race condition → конфликт параллельных операций       │
│     - deadlock → взаимная блокировка                        │
│     - timeout → превышение времени ожидания                 │
│     - rollback → откат изменений                            │
│     - commit → фиксация / проведение                        │
│     - debug → отладка                                       │
│                                                             │
│  ИСКЛЮЧЕНИЯ (допустимы):                                    │
│     - Названия полей 1С: "Проведен", "ПометкаУдаления"     │
│     - Названия объектов: "Документ.ЗаказКлиента"           │
│     - SQL, API — только в технических примерах кода         │
│                                                             │
│  ПРИЧИНА:                                                   │
│  ФМ читают бизнес-пользователи, не программисты.           │
│  Англицизмы снижают понятность и вызывают вопросы.         │
└─────────────────────────────────────────────────────────────┘
```

### 3. Версионирование ФМ

```
X.Y.Z где:
- X — мажорная версия (новый процесс)
- Y — минорная версия (новые разделы/функции)
- Z — патч (исправления, уточнения)

Примеры:
- 1.0.0 → 1.0.1 (патч после аудита)
- 1.0.1 → 1.1.0 (добавлен новый раздел)
- 1.1.0 → 2.0.0 (переделан весь процесс)
```

### 4. Применение изменений (/apply)

```
┌─────────────────────────────────────────────────────────────┐
│  КРИТИЧНО: ИНТЕГРИРОВАТЬ ИЗМЕНЕНИЯ СРАЗУ В ОСНОВНОЙ ТЕКСТ! │
├─────────────────────────────────────────────────────────────┤
│  ❌ ЗАПРЕЩЕНО:                                              │
│     - Создавать разделы "ДОПОЛНЕНИЯ И УТОЧНЕНИЯ"           │
│     - Добавлять изменения в конец документа отдельным блоком│
│     - Оставлять изменения "на потом для интеграции"        │
│     - Создавать приложения с изменениями                    │
│                                                             │
│  ✅ ВСЕГДА:                                                  │
│     - Интегрировать изменения СРАЗУ в основной текст        │
│     - Редактировать существующие пункты документа           │
│     - Готовый документ с интегрированными изменениями       │
│     - Пользователь получает финальный документ, не черновик │
└─────────────────────────────────────────────────────────────┘

ПОСЛЕ АУДИТА/АНАЛИЗА:

1. Показал список проблем/замечаний
2. СРАЗУ СПРАШИВАЮ:
   "Внести изменения в ФМ и создать версию X.Y.Z?"

3. Если пользователь говорит ДА:
   - Уточняю: "Какие замечания применить? Все / Только критические / Конкретные номера"
   - Вношу изменения СРАЗУ В ОСНОВНОЙ ТЕКСТ документа (СОХРАНЯЯ ФОРМАТ!)
   - Нахожу соответствующие пункты и редактирую их напрямую
   - Создаю новую версию файла
   - Показываю список изменений

4. Формат вывода:
   "Создана версия X.Y.Z. Изменения:
    - п. 3.4: [что изменено]
    - п. 3.7: [что изменено]
    - ..."
```

### 5. Обязательные метаданные при /apply

```
┌─────────────────────────────────────────────────────────────┐
│  ПРИ СОЗДАНИИ НОВОЙ ВЕРСИИ DOCX ОБЯЗАТЕЛЬНО ОБНОВИТЬ:      │
├─────────────────────────────────────────────────────────────┤
│  1. КОЛОНТИТУЛ (header/footer)                              │
│     - Версия документа в верхнем колонтитуле               │
│     - Пример: "FM-SHPMNT-PROFIT v2.5.1" → "v2.5.2"         │
│                                                             │
│  2. ЗАГОЛОВОК/ПАСПОРТ документа                            │
│     - Версия в теле документа                              │
│     - Дата последнего изменения                            │
│                                                             │
│  3. ИСТОРИЯ ИЗМЕНЕНИЙ (если есть в документе)              │
│     - Добавить запись о текущей версии                     │
│                                                             │
│  ⚠️ ПРОВЕРИТЬ ПРОГРАММНО:                                   │
│     - Поиск по всему документу старой версии               │
│     - Замена во ВСЕХ местах, включая таблицы               │
└─────────────────────────────────────────────────────────────┘
```

### 6. Верификация изменений (КРИТИЧНО!)

```
┌─────────────────────────────────────────────────────────────┐
│  ПРАВИЛО: НЕ ОТМЕЧАТЬ ✅ БЕЗ РЕАЛЬНОЙ ПРОВЕРКИ!            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ❌ ЗАПРЕЩЕНО:                                              │
│     - Отмечать ✅ на основе "скрипт выполнился"            │
│     - Писать "Готово" без верификации                      │
│     - Доверять автоматическим проверкам без перепроверки   │
│                                                             │
│  ✅ ОБЯЗАТЕЛЬНО:                                            │
│     - После каждого скрипта — ПРОВЕРКА наличия изменений   │
│     - Искать ОТСУТСТВИЕ старых значений (не только новые)  │
│     - Проверять ВСЕ места: параграфы, таблицы, колонтитулы │
│     - Для форматирования (шрифт, заливка) — отдельная      │
│       проверка через python-docx свойств                   │
│                                                             │
│  АЛГОРИТМ ВЕРИФИКАЦИИ:                                      │
│  1. Скрипт внесения изменений                              │
│  2. Скрипт проверки: ищем ВСЕ правки из списка             │
│  3. Скрипт проверки: ищем ОТСУТСТВИЕ старых значений       │
│  4. Если что-то не найдено — ИСПРАВЛЯЕМ, а не игнорируем   │
│  5. Только после 2+3+4 отмечаем ✅                          │
│                                                             │
│  ПРИЧИНА ОШИБОК:                                            │
│  - Текст в разных runs (Word разбивает форматирование)     │
│  - Текст в таблицах (отдельная структура)                  │
│  - Колонтитулы (отдельный объект section.header/footer)    │
│  - Заливка ≠ цвет шрифта (shading vs font.color)          │
└─────────────────────────────────────────────────────────────┘
```

### 7. Бэкапы перед программными изменениями

```
┌─────────────────────────────────────────────────────────────┐
│  ПЕРЕД ЛЮБЫМ ПРОГРАММНЫМ ИЗМЕНЕНИЕМ DOCX:                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. СОЗДАТЬ БЭКАП:                                          │
│     cp файл.docx файл.bak                                   │
│                                                             │
│  2. ПРОВЕРИТЬ ЧТО БЭКАП СОЗДАН:                             │
│     ls -la *.bak                                            │
│                                                             │
│  3. ТОЛЬКО ПОТОМ ВЫПОЛНЯТЬ СКРИПТ                           │
│                                                             │
│  ⚠️ ЕСЛИ СКРИПТ СЛОМАЛ ДОКУМЕНТ:                            │
│     cp файл.bak файл.docx                                   │
│     → Исправить скрипт и повторить                          │
│                                                             │
│  УДАЛЯТЬ БЭКАП ТОЛЬКО ПОСЛЕ:                                │
│     - Успешной верификации изменений                        │
│     - Подтверждения пользователем                           │
└─────────────────────────────────────────────────────────────┘
```

### 8. Нумерация в документах

```
┌─────────────────────────────────────────────────────────────┐
│  ПРАВИЛО: Только цифровая нумерация (1., 1.1., 1.1.1.)      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ❌ ЗАПРЕЩЕНО:                                              │
│     - Смесь цифр и букв: 3.2а., 3.4б.                       │
│     - Текстовая нумерация (просто текст "1." в начале)      │
│                                                             │
│  ✅ ИСПОЛЬЗОВАТЬ:                                           │
│     - Word-нумерацию (функция списков)                      │
│     - Только цифры: 1., 1.1., 1.1.1., ...                   │
│     - При добавлении раздела — перенумеровать               │
└─────────────────────────────────────────────────────────────┘
```

### 9. Файл изменений (CHANGES.md) — ОБЯЗАТЕЛЬНО!

```
┌─────────────────────────────────────────────────────────────┐
│  ПРИ КАЖДОМ /apply СОЗДАВАТЬ ФАЙЛ ИЗМЕНЕНИЙ:                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ФОРМАТ ИМЕНИ:                                              │
│     FM-[NAME]-v[X.Y.Z]-CHANGES.md                           │
│     Пример: FM-SHPMNT-PROFIT-v2.5.3-CHANGES.md              │
│                                                             │
│  СОДЕРЖАНИЕ:                                                │
│  1. Заголовок с датой, агентом, задачей                    │
│  2. Таблица изменений (ID, Где, Было, Стало, Причина)      │
│  3. Не применённые изменения (LOW) с причинами             │
│  4. Решения по уточняющим вопросам                         │
│  5. Результат верификации (чек-лист ✅)                     │
│                                                             │
│  ⚠️ СОЗДАВАТЬ СРАЗУ ПОСЛЕ ВЕРИФИКАЦИИ, ДО ОТЧЁТА ЮЗЕРУ!    │
│                                                             │
│  📁 ВСЕ ФАЙЛЫ СОХРАНЯТЬ В: FM_DOCUMENTS/                    │
└─────────────────────────────────────────────────────────────┘
```

### 10. Хранилище ФМ и результатов (в папке проекта)

```
┌─────────────────────────────────────────────────────────────┐
│  КАЖДАЯ ФМ = ОТДЕЛЬНЫЙ ПРОЕКТ В ПАПКЕ PROJECT_[NAME]/       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  СТРУКТУРА ПРОЕКТА:                                         │
│     PROJECT_[NAME]/                                         │
│     ├── README.md                    ← Обзор проекта        │
│     ├── FM_DOCUMENTS/                ← ВСЕ ВЕРСИИ ФМ        │
│     │   ├── README.md                ← История версий       │
│     │   ├── FM-*-v*.docx             ← Версии документа     │
│     │   ├── FM-*-CHANGES.md          ← Списки изменений     │
│     │   └── *.bak                    ← Бэкапы (временные)   │
│     │                                                       │
│     ├── AGENT_1_ARCHITECT/           ← Результаты аудита    │
│     ├── AGENT_2_ROLE_SIMULATOR/      ← Симуляции ролей      │
│     ├── AGENT_3_DEFENDER/            ← Ответы на замечания  │
│     ├── AGENT_4_QA_TESTER/           ← Тест-кейсы           │
│     ├── AGENT_5_TECH_ARCHITECT/      ← ТЗ на разработку     │
│     └── REPORTS/                     ← Итоговые отчёты      │
│                                                             │
│  ПРИ РАБОТЕ С ФМ:                                           │
│  1. Определить проект: PROJECT_[NAME]/                      │
│  2. ФМ читать/писать в PROJECT_[NAME]/FM_DOCUMENTS/         │
│  3. Результаты роли → PROJECT_[NAME]/AGENT_X_[ROLE]/        │
│  4. Обновлять PROJECT_[NAME]/README.md при изменениях       │
│                                                             │
│  ❌ НЕ хранить ФМ и результаты в корне fm-review-system/!   │
└─────────────────────────────────────────────────────────────┘
```

### 11. Предварительный обзор перед правками

```
┌─────────────────────────────────────────────────────────────┐
│  ПЕРЕД ВНЕСЕНИЕМ ПРАВОК В DOCX:                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ШАГ 1: ПОКАЗАТЬ ПЛАН ИЗМЕНЕНИЙ                             │
│     - Список всех правок с ID                              │
│     - Для каждой: Где → Было → Станет                      │
│     - Дать пользователю возможность скорректировать        │
│                                                             │
│  ШАГ 2: ПОЛУЧИТЬ ПОДТВЕРЖДЕНИЕ                              │
│     - "Применить N правок?" или                            │
│     - Выбор конкретных номеров                             │
│                                                             │
│  ШАГ 3: ТОЛЬКО ПОСЛЕ ПОДТВЕРЖДЕНИЯ                          │
│     - Создать бэкап                                        │
│     - Применить правки                                     │
│     - Верифицировать                                       │
│     - Создать CHANGES.md                                   │
│                                                             │
│  ❌ ЗАПРЕЩЕНО: Применять правки без показа плана!           │
└─────────────────────────────────────────────────────────────┘
```

---

## 💾 АВТОСОХРАНЕНИЕ

> ⚠️ Все файлы ниже находятся в папке `docs/` (docs/PROJECT_CONTEXT.md, docs/CHANGELOG.md, docs/WORKPLAN.md)

### Когда обновлять PROJECT_CONTEXT.md

```
ПОСЛЕ КАЖДОЙ КОМАНДЫ агента записывать:

### [Дата] — [АГЕНТ]: [команда]

**Проверено/Сделано:** [Что анализировалось/создавалось]

**Найдено:**
- [КОД-XXX] [Описание] → [Статус: открыто/решено]

**Решения:** [Если приняты]

**Открытые вопросы:**
- [ ] [Вопрос]
```

### Когда обновлять CHANGELOG.md

```
ОБНОВЛЯТЬ КОГДА:
- Изменена версия ФМ (/apply)
- Изменён агент
- Добавлена новая функциональность

ФОРМАТ:
## [vX.Y] — ДД.ММ.ГГГГ
### Что изменено
- Пункт 1
- Пункт 2
```

### Когда обновлять WORKPLAN.md

```
┌─────────────────────────────────────────────────────────────┐
│  ОБЯЗАТЕЛЬНО ОБНОВЛЯТЬ:                                    │
├─────────────────────────────────────────────────────────────┤
│  1. В НАЧАЛЕ сессии — записать план работ                  │
│  2. ПО ХОДУ работы — отмечать выполненное (🔴→🟡→🟢)       │
│  3. В КОНЦЕ сессии — итог, что сделано                     │
│  4. При ОБРЫВЕ — позволяет восстановить контекст           │
└─────────────────────────────────────────────────────────────┘

НЕ СПРАШИВАЙ "сохранить?" — СОХРАНЯЙ ВСЕГДА АВТОМАТИЧЕСКИ!
```

---

## 🔧 1С-ФОКУС (для AGENT_1)

При анализе каждого бизнес-правила проверять:

```
□ ПОСЛЕДОВАТЕЛЬНОСТЬ — можно ли сделать раньше/позже?
□ СОСТОЯНИЯ И ПЕРЕХОДЫ — все ли описаны? Можно ли перескочить?
□ ПРОВЕДЕНИЕ — когда контроль: до/при/после?
□ БЛОКИРОВКИ — что если два пользователя одновременно?
□ ПРАВА ДОСТУПА — кто может? А админ? А служебный?
□ ИДЕМПОТЕНТНОСТЬ — что если повторно провести?
□ ОТКАТ/СТОРНО — как отменить? Что с зависимыми данными?
□ ИНТЕГРАЦИИ — что если лаг/недоступность/ошибка?
□ ФОНОВЫЕ ЗАДАНИЯ — что в фоне? Что если не отработало?
□ АУДИТ — как найти кто/когда/что сделал?
```

---

## 🚫 АНТИПАТТЕРНЫ (искать и отмечать)

```
❌ "Требуется согласование" там, где можно автоправило
❌ "Запрещено" там, где нужно "разрешено с контролем"
❌ Цепочки согласований больше 2 уровней
❌ Ручные проверки того, что можно проверить автоматом
❌ "Молчание = отказ" для позитивных кейсов
❌ Контроль только на UI (обходится через API)
❌ Отсутствие дефолтов (что если не ответили?)
```

---

## 🎭 ГЛАВНЫЙ ПРИНЦИП

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   КОНТРОЛЬ НЕ ДОЛЖЕН ТОРМОЗИТЬ ОСНОВНОЙ БИЗНЕС-ПРОЦЕСС    │
│                                                             │
│   При каждом замечании/предложении спрашивай себя:         │
│   "Это ускоряет или замедляет продажи/операции?"           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📁 СТРУКТУРА ПРОЕКТА

```
fm-review-system/
├── CLAUDE.md                 ← Этот файл (правила, читается Claude Code автоматически)
├── README.md                 ← Описание системы
│
├── agents/                   ← 9 АГЕНТОВ
│   ├── AGENT_0_CREATOR.md    ← Создание ФМ
│   ├── AGENT_1_ARCHITECT.md  ← Аудит ФМ
│   ├── AGENT_2_ROLE_SIMULATOR.md ← Симуляция ролей
│   ├── AGENT_3_DEFENDER.md   ← Защита ФМ
│   ├── AGENT_4_QA_TESTER.md  ← Тестирование
│   ├── AGENT_5_TECH_ARCHITECT.md ← Проектирование + ТЗ
│   ├── AGENT_6_PRESENTER.md  ← Презентации
│   ├── AGENT_7_MIGRATOR.md   ← Миграция в Notion
│   └── AGENT_8_EPC_DESIGNER.md ← ePC в Miro
│
├── docs/                     ← ДОКУМЕНТАЦИЯ
│   ├── PROMPTS.md            ← Промпты для запуска
│   ├── CHANGELOG.md          ← История изменений
│   ├── TODOS.md              ← Трекер задач
│   ├── AUDIT_REPORT.md       ← Аудит системы
│   ├── CHAT_CONTEXT.md       ← Контекст чатов
│   ├── PROJECT_CONTEXT.md    ← Контекст проекта (авто)
│   └── WORKPLAN.md           ← План работ (авто)
│
├── projects/                 ← РАБОЧИЕ ПРОЕКТЫ
│   ├── PROJECT_SHPMNT_PROFIT/← Контроль рентабельности
│   └── PROJECT_SALES_PIPELINE/← Проектные продажи
│
├── schemas/                  ← JSON-схемы Notion БД
├── templates/                ← Шаблоны Notion-страниц
├── workflows/                ← Сквозные сценарии
└── scripts/                  ← Bash-скрипты запуска
```

---

## 📂 ПРОЕКТЫ (ПАПКИ PROJECT_*)

```
┌─────────────────────────────────────────────────────────────┐
│  ПРАВИЛО РАБОТЫ С ПРОЕКТАМИ                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Если задача относится к ФМ в ПРОЕКТЕ (папка PROJECT_*):   │
│                                                             │
│  1. ФМ читать/писать в PROJECT_*/FM_DOCUMENTS/              │
│  2. Результаты роли → PROJECT_*/AGENT_X_[ROLE]/             │
│  3. Обновлять PROJECT_*/README.md при изменениях            │
│                                                             │
│  АГЕНТЫ РАБОТАЮТ ТАК:                                       │
│  - AGENT_1 (аудит) → PROJECT_*/AGENT_1_ARCHITECT/           │
│  - AGENT_2 (роли)  → PROJECT_*/AGENT_2_ROLE_SIMULATOR/      │
│  - AGENT_3 (защита)→ PROJECT_*/AGENT_3_DEFENDER/            │
│  - AGENT_4 (тесты) → PROJECT_*/AGENT_4_QA_TESTER/           │
│  - AGENT_5 (ТЗ)    → PROJECT_*/AGENT_5_TECH_ARCHITECT/      │
│                                                             │
│  Каждый проект = отдельная ФМ с полной историей работы     │
└─────────────────────────────────────────────────────────────┘
```

### Текущие проекты

| Папка | ФМ | Статус | Описание |
|-------|-----|--------|----------|
| `PROJECT_SHPMNT_PROFIT/` | FM-SHPMNT-PROFIT v2.5.3 | В работе | Контроль рентабельности при частичных отгрузках |
| `PROJECT_SALES_PIPELINE/` | — | Планирование | Оптимизация воронки, стадии, сметы |

### Когда создавать проект

```
СОЗДАВАТЬ ПРОЕКТ PROJECT_[NAME]/, если:
- Новая ФМ (отдельная тематика)
- Полноценная функциональная модель (не мини-ФМ)
- Требуется работа нескольких агентов

СТРУКТУРА ПРОЕКТА:
PROJECT_[NAME]/
├── README.md                    ← Обзор проекта + текущая версия
├── FM_DOCUMENTS/                ← ВСЕ ВЕРСИИ ФМ
│   ├── README.md                ← История версий
│   ├── FM-*-v*.docx             ← Версии документа
│   ├── FM-*-CHANGES.md          ← Списки изменений
│   └── *.bak                    ← Бэкапы
├── AGENT_1_ARCHITECT/           ← Отчёты аудита
│   └── audit-reports/
├── AGENT_2_ROLE_SIMULATOR/      ← Симуляции ролей
│   └── UX-FINDINGS-*.md
├── AGENT_3_DEFENDER/            ← Ответы на замечания
│   └── review-responses/
├── AGENT_4_QA_TESTER/           ← Тест-кейсы
│   └── test-cases/
├── AGENT_5_TECH_ARCHITECT/      ← Технические задания
│   └── tz/
└── REPORTS/                     ← Итоговые сводки
    └── summary-v*.md
```

---

## 🚀 ЗАПУСК АГЕНТА

```
1. Определить проект: PROJECT_[NAME]/
2. Загрузить файл агента (AGENT_X_NAME.md)
3. Загрузить ФМ из PROJECT_[NAME]/FM_DOCUMENTS/
4. Выполнить команду (/audit, /new, /tz, и т.д.)
5. Отвечать на вопросы в диалоговом режиме
6. После анализа — /apply для внесения изменений
7. Результаты сохраняются в PROJECT_[NAME]/AGENT_X_*/
```

Полный список команд — см. `docs/PROMPTS.md`

---

## 🔄 PIPELINE (КОНВЕЙЕР АГЕНТОВ)

```
┌─────────────────────────────────────────────────────────────┐
│  NOTION-FIRST КОНВЕЙЕР:                                    │
│                                                             │
│  Agent 0 (Creator)     → создание контента ФМ              │
│         ↓                                                    │
│  Agent 7 (Migrator)    → СОЗДАНИЕ В NOTION (source of truth)│
│         ↓                ФМ-страница + 5 БД заполнены       │
│  Agent 1 (Architect)   → аудит → findings → Notion         │
│         ↓                                                    │
│  Agent 2 (Simulator)   → UX-проблемы → Notion              │
│         ↓                                                    │
│  Agent 4 (QA Tester)   → тесты + дыры → Notion             │
│         ↓                                                    │
│  Agent 5 (Tech Arch)   → архитектура + ТЗ                  │
│         ↓                                                    │
│  Quality Gate          → проверка готовности                │
│         ↓                                                    │
│  Agent 8 (EPC Designer)→ ePC в Miro → embed в Notion       │
│         ↓                                                    │
│  [Бизнес-согласование] → Notion: Draft → Review → Approved │
│         ↓                бизнес ревьюит, оставляет замечания│
│  Agent 3 (Defender)    → ответы на замечания бизнеса       │
│         ↓                                                    │
│  Agent 6 (Presenter)   → презентация + отчёты              │
│                                                             │
│  ⚠️ SOURCE OF TRUTH = NOTION (не Word!)                    │
│  ⚠️ Word/DOCX — только для legacy-миграции                 │
└─────────────────────────────────────────────────────────────┘
```

### Правила конвейера

1. **Notion — source of truth**: ФМ создаётся и живёт в Notion, не в Word
2. **Каждый агент читает результаты предыдущих**: сканирует PROJECT_[NAME]/AGENT_*/ и Notion-страницу
3. **Контекст передается автоматически**: через PROJECT_CONTEXT.md (включает Notion URL, Miro Board URL)
4. **Quality gate перед передачей**: скрипт `scripts/quality_gate.sh` проверяет Notion-страницу и ePC
5. **Версия ФМ инкрементируется**: в Notion БД "История версий"
6. **Бизнес-согласование**: после Quality Gate статус в Notion меняется Draft → Review, бизнес оставляет замечания

### Запуск конвейера

```
# Через оркестратор (рекомендуется):
./scripts/orchestrate.sh → "Полный цикл review"

# По шагам:
./scripts/agent0_new.sh → Claude Code → /new → контент ФМ
./scripts/agent7_migrate.sh → Claude Code → /auto → создание в Notion
./scripts/agent1_audit.sh → Claude Code → /audit → findings
./scripts/agent2_simulate.sh → Claude Code → /simulate-all
./scripts/agent4_test.sh → Claude Code → /generate-all
./scripts/agent5_architect.sh → Claude Code → /full
./scripts/quality_gate.sh PROJECT_[NAME]
./scripts/agent8_epc.sh → Claude Code → /auto → ePC в Miro + embed в Notion
./scripts/agent6_present.sh → Claude Code → /present

# Natural language (в Claude Code):
"Запусти аудит ФМ FM-LS-PROFIT"       → Agent 1 /audit
"Проанализируй замечания от бизнеса"   → Agent 3 /respond
"Создай ePC для этой ФМ"              → Agent 8 /epc
"Подготовь презентацию для директоров" → Agent 6 /present
```

---

## 🔗 КРОСС-АГЕНТНЫЙ ПОТОК ДАННЫХ

```
┌─────────────────────────────────────────────────────────────┐
│  КАЖДЫЙ АГЕНТ ПРИ СТАРТЕ:                                  │
│                                                             │
│  1. Читает PROJECT_CONTEXT.md — текущий контекст           │
│  2. Читает .interview_context.txt — параметры интервью     │
│  3. Сканирует AGENT_*/ — результаты других агентов         │
│  4. Определяет версию ФМ из FM_DOCUMENTS/                  │
│                                                             │
│  КАЖДЫЙ АГЕНТ ПРИ ЗАВЕРШЕНИИ:                              │
│                                                             │
│  1. Сохраняет результат в PROJECT_[NAME]/AGENT_X_*/        │
│  2. Обновляет PROJECT_CONTEXT.md                           │
│  3. Обновляет WORKPLAN.md                                  │
│  4. Обновляет CHANGELOG.md                                 │
│  5. При /apply — создает новую версию ФМ                   │
└─────────────────────────────────────────────────────────────┘
```

### Что каждый агент использует от других

| Агент | Читает от | Что использует |
|-------|-----------|----------------|
| Agent 1 | — | Чистый анализ ФМ |
| Agent 2 | Agent 1 | Найденные замечания для фокуса симуляции |
| Agent 3 | Agent 1, 2 | Замечания для формирования ответов |
| Agent 4 | Agent 1, 2 | Замечания и UX-проблемы для тест-кейсов |
| Agent 5 | Agent 1, 2, 4 | Полная картина для архитектуры |
| Agent 6 | Все | Синтез для презентации |
| Agent 7 | Agent 0 или ФМ DOCX | Миграция контента в Notion (5 БД + страницы) |
| Agent 8 | Agent 7 (Notion) или ФМ | ePC-диаграммы в Miro, embed-ссылки для Notion |

---

## 🌐 MCP-ИНТЕГРАЦИИ

### ⚙️ MCP Setup — Настройка подключения

```
ПРЕДВАРИТЕЛЬНЫЕ ТРЕБОВАНИЯ:
1. Claude Code установлен (https://docs.anthropic.com/en/docs/claude-code)
2. MCP серверы настроены в ~/.claude/claude_desktop_config.json

НАСТРОЙКА NOTION MCP:
1. Создать Integration в Notion (https://www.notion.so/my-integrations)
2. Получить Internal Integration Token
3. Расшарить нужные БД с Integration
4. Добавить в claude_desktop_config.json:
   {
     "mcpServers": {
       "notion": {
         "command": "npx",
         "args": ["-y", "@modelcontextprotocol/server-notion"],
         "env": {"NOTION_API_KEY": "ntn_xxxxxxxxxxxxx"}
       }
     }
   }

НАСТРОЙКА MIRO MCP:
1. Создать App в Miro (https://miro.com/app/settings/user-profile/apps)
2. Получить Access Token
3. Добавить в claude_desktop_config.json:
   {
     "mcpServers": {
       "miro": {
         "type": "url",
         "url": "https://mcp.miro.com/sse"
       }
     }
   }

ПРОВЕРКА ПОДКЛЮЧЕНИЯ:
- В Claude Code: спроси "какие MCP-инструменты доступны?"
- Notion: должны появиться notion_* tools
- Miro: должны появиться MIRO:* tools

FALLBACK (если MCP недоступен):
- Agent 7: /extract сохранит данные локально в JSON
- Agent 8: сгенерирует DSL-описание диаграммы в текстовый файл
- Данные можно загрузить в Notion/Miro позже вручную или через повторный запуск
```

### Notion MCP

```
КОГДА: Agent 7 → /migrate (основной), Agent 6 → /export-notion (презентации)
ДЛЯ ЧЕГО: Хранение ФМ, требований, глоссария, рисков, истории версий

5 БАЗ ДАННЫХ (см. schemas/notion-databases.md):
1. Функциональные модели (FM) — реестр всех ФМ (статус, версия, владелец)
2. Требования (Requirements) — ID, тип, приоритет, статус реализации
3. Глоссарий (Glossary) — термины, определения, контекст, синонимы
4. Риски (Risks) — вероятность, влияние, митигация
5. История версий (Version History) — дата, автор, описание изменений

ШАБЛОНЫ (см. templates/):
- fm-notion-page.md — полная страница ФМ
- requirement-template.md — карточка требования
- glossary-risks-template.md — глоссарий + риски

ПРАВИЛА:
- Не дублировать — обновлять существующие страницы
- Метаданные: версия, дата, автор, статус
- Связи между БД: ФМ ↔ требования ↔ тесты ↔ риски
- Валидация после миграции: Word vs Notion (Agent 7 → /validate)
```

### Miro MCP

```
КОГДА: Agent 8 → /epc (основной), Agent 6 → /export-miro (схемы)
ДЛЯ ЧЕГО: ePC-диаграммы бизнес-процессов, BPMN, архитектура

НОТАЦИЯ ePC (Event-driven Process Chain):
🔷 Событие (розовый шестиугольник #FFB6C1) — триггер/результат
🟩 Функция (зеленый прямоугольник #90EE90) — действие/операция
◇  XOR (желтый ромб #FFD700) — исключающий выбор
◇  AND (оранжевый ромб #FFA500) — параллельное выполнение
🟡 Орг. единица (светло-желтый овал #FFFFE0) — роль/подразделение
🔵 ИС (голубой прямоугольник #ADD8E6) — информационная система
📄 Документ (бежевый #F5F5DC) — вход/выход данных

ИНСТРУМЕНТЫ Miro MCP:
- diagram_create — flowchart (ePC через flowchart DSL)
- doc_create — текстовые блоки, описания
- table_create — RACI-матрицы, реестры
- board_list_items — навигация по доске

ПРАВИЛА:
- Каждый процесс ФМ = отдельная ePC-диаграмма
- Embed-ссылка из Miro вставляется в Notion-страницу ФМ
- Валидация: все функции покрыты событиями, нет висячих элементов
```

---

## 🤝 БИЗНЕС-СОГЛАСОВАНИЕ (Approval Workflow)

```
ВОРКФЛОУ СОГЛАСОВАНИЯ ФМ В NOTION:

┌──────────────────────────────────────────────────────────────────┐
│                                                                  │
│  1. DRAFT (черновик)                                            │
│     Кто: Agent 0 создал → Agent 7 опубликовал в Notion          │
│     Статус Notion: Draft (серый)                                │
│     Действие: ФМ доступна для внутреннего ревью (Agents 1-5)    │
│                                                                  │
│  2. INTERNAL REVIEW (внутренний ревью)                          │
│     Кто: Agents 1-5 проверили, замечания исправлены             │
│     Статус Notion: Draft → Review (жёлтый)                      │
│     Действие: Notion-страница расшаривается бизнес-заказчику    │
│                                                                  │
│  3. BUSINESS REVIEW (согласование с бизнесом)                   │
│     Кто: Бизнес-заказчик открывает Notion, читает ФМ            │
│     Как: Оставляет комментарии прямо в Notion                   │
│     Срок: 3 рабочих дня (настраиваемо)                         │
│     Действие: Agent 3 (Defender) анализирует замечания          │
│                                                                  │
│  4. REWORK (доработка по замечаниям)                            │
│     Кто: Agent 3 формирует ответы, Agent 0 вносит правки       │
│     Статус Notion: Review (остаётся)                            │
│     Действие: повторный цикл до снятия всех замечаний           │
│                                                                  │
│  5. APPROVED (согласовано)                                      │
│     Кто: Бизнес-заказчик подтверждает                           │
│     Статус Notion: Review → Approved (зелёный)                  │
│     Действие: Agent 8 создаёт финальную ePC, Agent 6 отчёт     │
│                                                                  │
│  6. ARCHIVED (архив)                                            │
│     Когда: Новая версия ФМ заменяет текущую                    │
│     Статус Notion: Approved → Archived (коричневый)             │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘

КОМАНДЫ ДЛЯ БИЗНЕС-СОГЛАСОВАНИЯ:
- "Отправь ФМ на согласование"     → меняет статус Draft → Review
- "Проанализируй замечания"        → Agent 3 → /respond
- "ФМ согласована"                 → меняет статус Review → Approved
- "Покажи статус согласования"     → читает статус + комментарии из Notion
```

---

## 📜 СКРИПТЫ

```
scripts/
├── orchestrate.sh     ← ГЛАВНЫЙ ЛАУНЧЕР (единая точка входа, 9 агентов + управление)
├── new_project.sh     ← Создание нового проекта из шаблона
├── fm_version.sh      ← Управление версиями (list/diff/bump/log)
├── quality_gate.sh    ← Проверка готовности к передаче
├── export_notion.sh   ← Экспорт в Notion (через Agent 7)
├── export_miro.sh     ← Экспорт в Miro (через Agent 8)
├── agent0_new.sh      ← Интервью для создания ФМ
├── agent1_audit.sh    ← Интервью для аудита
├── agent2_simulate.sh ← Интервью для симуляции
├── agent3_defend.sh   ← Интервью для защиты
├── agent4_test.sh     ← Интервью для тестов
├── agent5_architect.sh← Интервью для архитектуры
├── agent7_migrate.sh  ← Интервью для миграции Word → Notion
├── agent8_epc.sh      ← Интервью для ePC-диаграмм в Miro
└── lib/
    └── common.sh      ← Общие функции (цвета, утилиты, проекты)
```

**Запуск:** `./scripts/orchestrate.sh` — единая точка входа для всех операций
