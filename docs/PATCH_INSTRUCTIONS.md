# Инструкция: Запись патчей (Self-Improvement)

> Включается в агентов 1-5. Каждый агент после завершения аудита/проверки
> записывает обобщенные паттерны ошибок в `.patches/`.

---

## КОГДА ЗАПИСЫВАТЬ ПАТЧ

После завершения `/audit`, `/simulate-all`, `/generate-all`, `/full` или `/auto`:
- Для КАЖДОЙ находки severity CRITICAL или HIGH → обязательный патч
- Для MEDIUM → патч только если паттерн может повториться в других ФМ
- LOW → не записывать

## КАК ЗАПИСЫВАТЬ

1. Обобщить находку до ПАТТЕРНА (не "в п.3.18 написано 6 мес", а "Противоречие значений параметра в основном тексте vs NOTE")
2. Создать файл: `.patches/YYYY-MM-DD_AGENT-N_PROJECT_category.md`
3. Заполнить по шаблону из `.patches/README.md`

## КЛЮЧЕВОЕ ПРАВИЛО

**Патч = обобщенный паттерн, а не конкретный баг.**

Плохо: "В п.3.18 FM-LS-PROFIT срок реабилитации 6 мес противоречит NOTE где 3 мес"
Хорошо: "Противоречие числовых значений между основным текстом раздела и NOTE/примечанием к нему"

Плохо: "Нет описания что делать при нулевой отгрузке"
Хорошо: "Не описано поведение формулы при граничных/нулевых значениях входных параметров"

## ГРУППИРОВКА

Если в одном аудите найдено 3+ находки одного типа (например, 3 битые ссылки),
создать ОДИН патч с обобщением, а не три отдельных.

## НЕ ДУБЛИРОВАТЬ

Перед записью прочитать существующие патчи в `.patches/`.
Если аналогичный паттерн уже записан - НЕ создавать новый.
