# Выбор моделей для агентов

> Обоснование выбора моделей для каждого субагента системы.

---

## Текущее распределение

| Агент | Модель | Обоснование |
|-------|--------|-------------|
| Agent 0 (Creator) | `opus` | Создание ФМ требует глубокого понимания бизнес-процессов, интервью, структурирования |
| Agent 1 (Architect) | `opus` | Критический агент: полный аудит бизнес-логики + совместимость 1С. Высший приоритет |
| Agent 2 (Simulator) | `opus` | Симуляция ролей требует "вживания" в роль, понимания UX-контекста |
| Agent 3 (Defender) | `opus` | Анализ замечаний бизнеса: нужен глубокий reasoning для классификации A-I |
| Agent 4 (QA Tester) | `sonnet` | Генерация тест-кейсов - структурированная задача, sonnet справляется |
| Agent 5 (Tech Architect) | `opus` | Проектирование архитектуры 1С: сложные решения, ТЗ, ARC-документы |
| Agent 6 (Presenter) | `sonnet` | Синтез отчетов и презентаций - форматирование, не глубокий анализ |
| Agent 7 (Publisher) | `sonnet` | Работа с Confluence API: PUT/GET, XHTML. Технические операции |
| Agent 8 (BPMN Designer) | `sonnet` | Генерация drawio-диаграмм - структурированная задача |

## Принцип выбора

```
opus  → Глубокий анализ, принятие решений, творческие задачи
sonnet → Структурированные задачи, форматирование, API-операции
haiku  → Не используется (субагенты требуют контекст ФМ)
```

**Правило:** Агенты с `disallowedTools: Write, Edit` (read-only) могут быть переведены на `sonnet` для экономии, если качество не падает.

## Когда менять модель

- **Повысить до opus:** агент регулярно пропускает проблемы или генерирует поверхностные результаты
- **Понизить до sonnet:** задача агента стала более шаблонной, качество не страдает
- **haiku:** только для вспомогательных одноразовых запросов (не для субагентов с полным контекстом ФМ)

## Бюджеты на агент (run_agent.py)

Каждый агент имеет `budget_usd` — максимальный расход на один запуск в пайплайне. Определено в `AGENT_REGISTRY` (`scripts/run_agent.py`).

| Агент | Модель | Бюджет | Обоснование |
|-------|--------|--------|-------------|
| Agent 0 (Creator) | opus | $8 | Длинное интервью, генерация ФМ |
| Agent 1 (Architect) | opus | $10 | Полный аудит 10 категорий |
| Agent 2 (Simulator) | opus | $8 | Симуляция 3-5 ролей |
| Agent 3 (Defender) | opus | $6 | Анализ findings от 1,2,4,5 |
| Agent 4 (QA Tester) | sonnet | $3 | Генерация тест-кейсов |
| Agent 5 (Tech Architect) | opus | $10 | Полный ТЗ с архитектурой |
| Agent 6 (Presenter) | sonnet | $3 | Синтез отчёта |
| Agent 7 (Publisher) | sonnet | $3 | Работа с Confluence API |
| Agent 8 (BPMN Designer) | sonnet | $3 | Генерация drawio |
| **Итого** | | **$54** | |

**Pipeline budget:** $60 (сумма агентов + $6 запас). При превышении пайплайн останавливается.

**Override:** `--max-budget 15.0` переопределяет бюджет для всех агентов. `--model opus` форсирует opus для всех, игнорируя per-agent модели.

## Стоимость

| Модель | Относительная стоимость | Скорость |
|--------|------------------------|----------|
| opus | Базовая (1x) | Медленная |
| sonnet | ~0.3x | Быстрая |
| haiku | ~0.05x | Очень быстрая |

Текущее соотношение: 5 opus + 4 sonnet. При 9 агентах в полном пайплайне — оптимальный баланс качества и стоимости. Полный прогон: ~$30-50 (зависит от размера ФМ).
