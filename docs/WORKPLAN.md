# WORKPLAN.md — План работ по системе FM Review Agents

> **Цель:** Отслеживание прогресса, восстановление контекста при обрыве сессии
> **Последнее обновление:** 18.02.2026, Блоки A+B завершены

---

## 🎯 ТЕКУЩИЙ СТАТУС

| Компонент | Статус | Последнее обновление |
|-----------|--------|---------------------|
| CLAUDE.md | 🟡 Обновляется | 18.02.2026 |
| Субагенты (.claude/agents/) | 🟡 Обновляются | 18.02.2026 |
| COMMON_RULES.md | 🟢 Готов | 18.02.2026 |
| AGENT_PROTOCOL.md | 🟢 Готов | 18.02.2026 |
| README.md | 🟢 Обновлен | 18.02.2026 |
| **PROJECT_SHPMNT_PROFIT/** | 🟢 Готов | 17.02.2026 |

**Легенда:** 🟢 Готов | 🟡 В работе | 🔴 Не начато / Устаревший | ⚪ Отменено

---

## 📋 СЕССИЯ 18.02.2026 — Повторный аудит: блоки A, B, C (В РАБОТЕ 🟡)

### Контекст
Повторный аудит системы выявил 15 верифицированных проблем + 14 рекомендаций из лучших практик 2026.
Все сгруппированы в 3 блока: A (quick wins), B (средний effort), C (roadmap).

---

### БЛОК A: Quick Wins (~30 мин)

| # | Задача | Файлы | Статус |
|---|--------|-------|--------|
| A-1 | Обновить README.md: заменить `experimental/run_agent.py` на `scripts/run_agent.py` | README.md | ✅ |
| A-2 | Добавить `maxTurns` во все 9 субагентов (15-25 по роли) | .claude/agents/agent-*.md (9 файлов) | ✅ |
| A-3 | Добавить `disallowedTools: Write, Edit` для Agent 1, 2, 3, 4 (только анализ) | .claude/agents/agent-{1,2,3,4}-*.md | ✅ |
| A-4 | Исправить description для agent-2-simulator (добавить /business, /roi) | .claude/agents/agent-2-simulator.md | ✅ |
| A-5 | Добавить `skills: [evolve]` в agent-1-architect | .claude/agents/agent-1-architect.md | ✅ |

---

### БЛОК B: Средний effort (~1-2ч)

| # | Задача | Файлы | Статус |
|---|--------|-------|--------|
| B-1 | Добавить `mcpServers` для Confluence в agent-0 и agent-7 | .claude/agents/agent-{0,7}-*.md | ✅ |
| B-2 | Добавить `permissionMode` по ролям агентов | .claude/agents/agent-*.md (9 файлов) | ✅ |
| B-3 | Добавить SubagentStop hook для валидации _summary.json | .claude/hooks/, .claude/settings.json | ✅ |
| B-4 | Создать шаблон PROJECT_CONTEXT.md | templates/PROJECT_CONTEXT.md | ✅ |
| B-5 | Дифференцировать tools по ролям агентов | .claude/agents/agent-*.md (9 файлов) | ✅ (выполнено в A-3) |

---

### БЛОК C: Крупные улучшения (roadmap, отдельные сессии)

| # | Задача | Effort | Статус |
|---|--------|--------|--------|
| C-1 | Разбить CLAUDE.md на компактный корень (200 строк) + Skills | 2-3ч | 🔴 |
| C-2 | Конвертировать агентов в Skills с `context: fork` | 3-4ч | 🔴 |
| C-3 | Переписать pipeline на Claude Agent SDK (Python) | 4-6ч | 🔴 |
| C-4 | Добавить DeepEval тесты для агентов | 4-6ч | 🔴 |
| C-5 | Настроить Langfuse для трейсинга pipeline | 2-3ч | 🔴 |

---

## 📋 СЕССИЯ v4.3 — Структура проектов (ЗАВЕРШЕНА ✅)

### Цель
Создать структуру папок проектов для хранения ФМ и результатов работы агентов.

### План работ

| # | Задача | Статус |
|---|--------|--------|
| 1 | Создать PROJECT_SHPMNT_PROFIT/ | ✅ |
| 2 | Переместить FM_DOCUMENTS/ в проект | ✅ |
| 3 | Переместить ROLE_SIMULATION/ → AGENT_2_ROLE_SIMULATOR/ | ✅ |
| 4 | Создать папки AGENT_1-5, REPORTS | ✅ |
| 5 | Создать PROJECT_SHPMNT_PROFIT/README.md | ✅ |
| 6 | Обновить ссылки в PROJECT_CONTEXT.md | ✅ |
| 7 | Обновить ссылки в CHANGELOG.md | ✅ |
| 8 | Обновить правила в CLAUDE.md | ✅ |
| 9 | Добавить раздел "СТРУКТУРА ПРОЕКТОВ" во все агенты | ✅ |
| 10 | Обновить PROMPTS.md, README.md, WORKPLAN.md | ✅ |

### Что изменено

**Структура проекта:**
```
PROJECT_[NAME]/
├── README.md              ← Обзор проекта
├── FM_DOCUMENTS/          ← ВСЕ ВЕРСИИ ФМ
├── AGENT_1_ARCHITECT/     ← Результаты аудита
├── AGENT_2_ROLE_SIMULATOR/← Симуляции ролей
├── AGENT_3_DEFENDER/      ← Ответы на замечания
├── AGENT_4_QA_TESTER/     ← Тест-кейсы
├── AGENT_5_TECH_ARCHITECT/← ТЗ
└── REPORTS/               ← Итоговые отчёты
```

**Создан проект:** PROJECT_SHPMNT_PROFIT/ (FM-SHPMNT-PROFIT v2.5.3)

---

## 📋 СЕССИЯ v4.2 — Интерактивный формат вопросов (ЗАВЕРШЕНА ✅)

### Цель
Переделать формат вопросов на интерактивное меню с рекомендациями эксперта.

### План работ

| # | Задача | Статус |
|---|--------|--------|
| 1 | Удалить AGENT_6_ORCHESTRATOR | ✅ |
| 2 | Обновить CLAUDE.md — формат вопросов | ✅ |
| 3 | AGENT_0 — интервью в формате меню | ✅ |
| 4 | AGENT_1 — интервью + /apply в формате меню | ✅ |
| 5 | AGENT_2 — интервью в формате меню | ✅ |
| 6 | AGENT_3 — интервью в формате меню | ✅ |
| 7 | AGENT_4 — интервью в формате меню | ✅ |
| 8 | AGENT_5 — интервью в формате меню | ✅ |
| 9 | Обновить CHANGELOG | ✅ |
| 10 | Обновить WORKPLAN | ✅ |

### Что изменено

**Формат вопросов:**
```
БЫЛО:
"Что в приоритете — скорость или контроль?"
→ Жду ответ

СТАЛО:
? Что в приоритете?

1. Скорость — не тормозить операции
2. Баланс скорости и контроля ⭐ рекомендуется
3. Контроль — максимальная защита
4. Другое (напишите)

💡 Почему 2: Для большинства процессов нужен баланс.

Ваш выбор (1-4):
```

---

## 📜 ИСТОРИЯ СЕССИЙ

### FM v2.5.5 — 28.01.2026 (завершена)
**Что сделано:**
- ✅ Все 19 замечаний из аудита v2.5.4 исправлены (22 правки)
- ✅ CRITICAL: противоречие 60/30 дней, контроль цен Заказа←ЛС
- ✅ HIGH: НПСС=NULL, блокировка ЛС, мульти-БЮ, черновики, SLA
- ✅ MEDIUM: округление, EDI, убыточный остаток, стратег.клиенты, таймауты, fallback, HR
- ✅ LOW: глоссарий, часовой пояс, опечатки, сроки хранения
- ✅ Верификация: все 20 проверок пройдены
- ✅ Файлы: FM-SHPMNT-PROFIT-v2.5.5.docx, CHANGES.md
- ✅ Готовность к разработке: 100%

### Аудит FM v2.5.4 — 28.01.2026 (завершена)
**Что сделано:**
- ✅ Финальный аудит FM-SHPMNT-PROFIT v2.5.4 (после принятия заказчиком)
- ✅ Найдено 19 замечаний: 2 CRITICAL, 5 HIGH, 7 MEDIUM, 5 LOW
- ✅ Чек-лист 1С-специфики: 4 ✅, 5 ⚠️, 1 ❌
- ✅ Отчёт: PROJECT_SHPMNT_PROFIT/AGENT_1_ARCHITECT/AUDIT-REPORT-v2.5.4-2026-01-28.md
- ✅ Все замечания исправлены → v2.5.5

### v4.3 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Создана структура папок проектов PROJECT_[NAME]/
- ✅ PROJECT_SHPMNT_PROFIT/ — ФМ контроля рентабельности
- ✅ Все агенты знают где искать ФМ и куда сохранять результаты
- ✅ Обновлены CLAUDE.md, README.md, PROMPTS.md
- ✅ Добавлен раздел "СТРУКТУРА ПРОЕКТОВ" во все файлы агентов

### v4.2 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Удалён AGENT_6_ORCHESTRATOR (не использовался)
- ✅ Интерактивный формат вопросов — меню с рекомендациями
- ✅ Все агенты (0-5) обновлены — вопросы в формате меню
- ✅ CLAUDE.md обновлён — раздел "Формат вопросов"

### v4.1 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Создан CLAUDE.md (243 строки)
- ✅ README.md упрощён, добавлена ссылка на CLAUDE.md
- ✅ Все агенты (0-5) обновлены — ссылка на CLAUDE.md
- ✅ CHANGELOG.md обновлён

### v4.0 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ AGENT_1 полностью переписан (бизнес + 1С в одном)
- ✅ Добавлен 1С-фокус (10 пунктов чек-листа)
- ✅ AGENT_5 расширен — добавлена команда /tz
- ✅ Обновлены README, PROMPTS, CHANGELOG

### v3.5 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Добавлена команда /apply во все агенты
- ✅ Автопредложение изменений после аудита
- ✅ Версионирование ФМ (X.Y.Z)

### v3.4 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Диалоговый режим во всех агентах
- ✅ По 1-2 вопроса за раз вместо таблиц

### v3.3 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Добавлен AGENT_0_CREATOR
- ✅ Добавлено правило формата (не менять оформление)

### v3.2 — 27.01.2026 (завершена)
**Что сделано:**
- ✅ Автосохранение после каждой команды
- ✅ Создан PROMPTS.md

---

## 📌 ПРАВИЛА РАБОТЫ С WORKPLAN

```
┌─────────────────────────────────────────────────────────────┐
│  КОГДА ОБНОВЛЯТЬ WORKPLAN.md:                              │
├─────────────────────────────────────────────────────────────┤
│  1. В НАЧАЛЕ сессии — записать план работ                  │
│  2. ПО ХОДУ работы — отмечать выполненное (🔴→🟡→🟢)       │
│  3. В КОНЦЕ сессии — итог, что сделано                     │
│  4. При ОБРЫВЕ — позволяет восстановить контекст           │
└─────────────────────────────────────────────────────────────┘
```

**НЕ СПРАШИВАЙ "обновить WORKPLAN?" — ОБНОВЛЯЙ ВСЕГДА АВТОМАТИЧЕСКИ!**
