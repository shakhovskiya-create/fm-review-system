---
name: fm-audit
description: "Чеклист аудита функциональной модели (ФМ). Загружается агентом 1 (Architect) при /audit. Содержит стандартные проверки бизнес-логики и 1С-совместимости."
user-invocable: false
allowed-tools: "Read, Grep, Glob"
---

# Аудит ФМ - чеклист и шаблоны

## Чеклист бизнес-логики (10 категорий)

### 1. Последовательность операций
- [ ] Все операции имеют явный порядок выполнения
- [ ] Нет операций, которые можно/нужно выполнить раньше/позже
- [ ] Зависимости между операциями документированы

### 2. Состояния и переходы
- [ ] Все состояния документа/объекта описаны
- [ ] Переходы между состояниями описаны явно
- [ ] Нет "перескоков" через промежуточные состояния
- [ ] Описаны начальное и конечное состояния

### 3. Проведение документов
- [ ] Момент контроля указан: до/при/после проведения
- [ ] Описано поведение при отмене проведения
- [ ] Описано поведение при повторном проведении (идемпотентность)

### 4. Блокировки и конкурентность
- [ ] Описано поведение при одновременной работе двух пользователей
- [ ] Указаны объекты блокировки (документ, таблица, строка)
- [ ] Указана длительность блокировки

### 5. Права доступа
- [ ] Указаны роли для каждой операции
- [ ] Описаны действия администратора
- [ ] Описаны ограничения по организации/подразделению

### 6. Откат и сторно
- [ ] Описан механизм отмены операции
- [ ] Описано влияние отмены на зависимые объекты
- [ ] Указан таймаут на отмену (если есть)

### 7. Интеграции
- [ ] Описано поведение при недоступности внешней системы
- [ ] Описан механизм повторных попыток
- [ ] Описано поведение при частичном ответе

### 8. Фоновые задания
- [ ] Указаны операции, выполняемые в фоне
- [ ] Описано поведение при сбое фонового задания
- [ ] Указана периодичность/расписание

### 9. Аудит и логирование
- [ ] Описано, какие действия логируются
- [ ] Указано, как найти "кто/когда/что сделал"
- [ ] Описан срок хранения логов

### 10. Данные и формулы
- [ ] Все формулы расчетов документированы
- [ ] Нет противоречий между формулами в разных разделах
- [ ] Указаны единицы измерения и точность округления
- [ ] Описаны значения по умолчанию (дефолты)

## Классификация замечаний

| Уровень | Описание | Действие |
|---------|----------|----------|
| CRITICAL | Противоречие, потеря данных, блокировка | Исправить обязательно |
| HIGH | Неполнота, двусмысленность | Исправить до передачи |
| MEDIUM | Неточность, неоднозначность | Рекомендуется исправить |
| LOW | Стиль, опечатки, улучшения | По желанию |

## Шаблон выходного отчета

Результат аудита сохранять в: `PROJECT_*/AGENT_1_ARCHITECT/audit-report-v{X.Y.Z}.md`

Обязательные секции отчета:
1. Заголовок с датой, версией ФМ, фокусом аудита
2. Сводка (кол-во по уровням: CRITICAL/HIGH/MEDIUM/LOW)
3. Таблица замечаний (ID, Уровень, Раздел, Описание, Рекомендация)
4. Чек-лист 1С-совместимости (10 пунктов)
5. Рекомендации по следующим шагам

После отчета создать `_summary.json` (схема: `schemas/agent-contracts.json`).

## Антипаттерны (искать и отмечать)

- "Требуется согласование" там, где можно автоправило
- "Запрещено" там, где нужно "разрешено с контролем"
- Цепочки согласований больше 2 уровней
- Ручные проверки того, что можно проверить автоматом
- "Молчание = отказ" для позитивных кейсов
- Контроль только на UI (обходится через API)
- Отсутствие дефолтов (что если не ответили?)
